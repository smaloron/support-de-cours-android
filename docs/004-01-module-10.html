<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-10-30T17:42:53.807996"><title>Module 10 : Persistance des Donn&eacute;es Simples (`SharedPreferences`) | Android</title><script type="application/json" id="virtual-toc-data">[{"id":"objectifs-p-dagogiques","level":0,"title":"Objectifs pédagogiques","anchor":"#objectifs-p-dagogiques"},{"id":"introduction","level":0,"title":"Introduction","anchor":"#introduction"},{"id":"notions-abord-es","level":0,"title":"Notions abordées","anchor":"#notions-abord-es"},{"id":"cas-d-usage-des-sharedpreferences","level":0,"title":"Cas d\u0027usage des SharedPreferences","anchor":"#cas-d-usage-des-sharedpreferences"},{"id":"lecture-et-criture","level":0,"title":"Lecture et Écriture","anchor":"#lecture-et-criture"},{"id":"tp-10-un-interrupteur-de-r-glages-persistants","level":0,"title":"TP 10 : Un interrupteur de réglages persistants","anchor":"#tp-10-un-interrupteur-de-r-glages-persistants"},{"id":"auto-valuation","level":0,"title":"Auto-évaluation","anchor":"#auto-valuation"},{"id":"correction-de-l-auto-valuation","level":0,"title":"Correction de l\u0027auto-évaluation","anchor":"#correction-de-l-auto-valuation"},{"id":"conclusion-du-module","level":0,"title":"Conclusion du module","anchor":"#conclusion-du-module"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Module 10 : Persistance des Donn&eacute;es Simples (`SharedPreferences`) | Android"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Android Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/004-01-module-10.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Module 10 : Persistance des Donn&eacute;es Simples (`SharedPreferences`) | Android"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/004-01-module-10.html#webpage",
    "url": "writerside-documentation/004-01-module-10.html",
    "name": "Module 10 : Persistance des Donn&eacute;es Simples (`SharedPreferences`) | Android",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Android Help"
}</script><!-- End Schema.org --></head><body data-id="004-01-module-10" data-main-title="Module 10 : Persistance des Données Simples (`SharedPreferences`)" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="004-partie-04.md|Partie 4 : Gestion des Données"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Android  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="004-01-module-10" id="004-01-module-10.md">Module 10 : Persistance des Données Simples (`SharedPreferences`)</h1><section class="chapter"><h2 id="objectifs-p-dagogiques" data-toc="objectifs-p-dagogiques">Objectifs p&eacute;dagogiques</h2><p id="-cxtpn1_13">&Agrave; la fin de ce module, vous serez capable de :</p><ul class="list _bullet" id="-cxtpn1_14"><li class="list__item" id="-cxtpn1_15"><p id="-cxtpn1_18">Identifier les cas d'usage appropri&eacute;s pour les <code class="code" id="-cxtpn1_19">SharedPreferences</code>.</p></li><li class="list__item" id="-cxtpn1_16"><p id="-cxtpn1_20">Lire et &eacute;crire des donn&eacute;es simples (cl&eacute;-valeur) de mani&egrave;re synchrone.</p></li><li class="list__item" id="-cxtpn1_17"><p id="-cxtpn1_21">Comprendre la diff&eacute;rence entre <code class="code" id="-cxtpn1_22">commit()</code> et <code class="code" id="-cxtpn1_23">apply()</code>.</p></li></ul></section><section class="chapter"><h2 id="introduction" data-toc="introduction">Introduction</h2><p id="-cxtpn1_24">Imaginez que vous voulez noter une information tr&egrave;s simple, comme le score le plus &eacute;lev&eacute; d'un joueur ou si l'utilisateur pr&eacute;f&egrave;re le mode sombre. Vous n'allez pas cr&eacute;er une base de donn&eacute;es complexe pour &ccedil;a. Vous allez simplement prendre un post-it et l'&eacute;crire dessus.</p><p id="-cxtpn1_25">Les <code class="code" id="-cxtpn1_26">SharedPreferences</code> sont exactement cela : le &quot;post-it&quot; num&eacute;rique de votre application. C'est un m&eacute;canisme simple et efficace pour stocker de petites quantit&eacute;s de donn&eacute;es primitives (bool&eacute;ens, cha&icirc;nes de caract&egrave;res, nombres) sous forme de paires cl&eacute;-valeur. C'est la solution parfaite pour les pr&eacute;f&eacute;rences utilisateur, les r&eacute;glages, ou de petites donn&eacute;es d'&eacute;tat.</p></section><section class="chapter"><h2 id="notions-abord-es" data-toc="notions-abord-es">Notions abord&eacute;es</h2><ul class="list _bullet" id="-cxtpn1_27"><li class="list__item" id="-cxtpn1_29"><p id="-cxtpn1_31">Cas d'usage des SharedPreferences</p></li><li class="list__item" id="-cxtpn1_30"><p id="-cxtpn1_32">Lecture et &Eacute;criture</p></li></ul></section><section class="chapter"><h2 id="cas-d-usage-des-sharedpreferences" data-toc="cas-d-usage-des-sharedpreferences">Cas d'usage des SharedPreferences</h2><section class="chapter"><h3 id="introduction-la-notion" data-toc="introduction-la-notion">Introduction &agrave; la notion</h3><p id="-cxtpn1_35">Savoir quand utiliser le bon outil est essentiel. Vous n'utilisez pas un marteau-piqueur pour planter un clou. De la m&ecirc;me mani&egrave;re, <code class="code" id="-cxtpn1_36">SharedPreferences</code> est un outil l&eacute;ger pour des besoins l&eacute;gers.</p></section><section class="chapter"><h3 id="explication-de-la-notion" data-toc="explication-de-la-notion">Explication de la notion</h3><p id="-cxtpn1_37">Les <code class="code" id="-cxtpn1_43">SharedPreferences</code> sont id&eacute;ales pour stocker :</p><ul class="list _bullet" id="-cxtpn1_38"><li class="list__item" id="-cxtpn1_44"><p id="-cxtpn1_47"><span class="control" id="-cxtpn1_48">Des r&eacute;glages utilisateur :</span> Mode sombre (Boolean), langue pr&eacute;f&eacute;r&eacute;e (String), notifications activ&eacute;es (Boolean).</p></li><li class="list__item" id="-cxtpn1_45"><p id="-cxtpn1_49"><span class="control" id="-cxtpn1_50">Des donn&eacute;es d'&eacute;tat simples :</span> Le score le plus &eacute;lev&eacute; (Int), le nom du dernier utilisateur connect&eacute; (String), si le tutoriel a d&eacute;j&agrave; &eacute;t&eacute; montr&eacute; (Boolean).</p></li><li class="list__item" id="-cxtpn1_46"><p id="-cxtpn1_51"><span class="control" id="-cxtpn1_52">Des jetons d'authentification simples.</span></p></li></ul><p id="-cxtpn1_39">Elles ne sont <span class="control" id="-cxtpn1_53">PAS</span> faites pour :</p><ul class="list _bullet" id="-cxtpn1_40"><li class="list__item" id="-cxtpn1_54"><p id="-cxtpn1_57">Stocker des donn&eacute;es complexes ou structur&eacute;es (listes d'objets, etc.).</p></li><li class="list__item" id="-cxtpn1_55"><p id="-cxtpn1_58">Stocker de grandes quantit&eacute;s de donn&eacute;es.</p></li><li class="list__item" id="-cxtpn1_56"><p id="-cxtpn1_59">Stocker des donn&eacute;es relationnelles.</p></li></ul><p id="-cxtpn1_41">Pour ces cas, nous utiliserons la base de donn&eacute;es <code class="code" id="-cxtpn1_60">Room</code> (Module 11).</p></section></section><section class="chapter"><h2 id="lecture-et-criture" data-toc="lecture-et-criture">Lecture et &Eacute;criture</h2><section class="chapter"><h3 id="introduction-la-notion_1" data-toc="introduction-la-notion_1">Introduction &agrave; la notion</h3><p id="-cxtpn1_64">Interagir avec le &quot;post-it&quot; (<code class="code" id="-cxtpn1_65">SharedPreferences</code>) se fait en deux &eacute;tapes tr&egrave;s simples : pour &eacute;crire, on demande la permission d'&eacute;diter, on &eacute;crit nos paires cl&eacute;-valeur, et on valide. Pour lire, on demande simplement &agrave; voir le post-it et on lit la valeur associ&eacute;e &agrave; une cl&eacute;, en pr&eacute;voyant une valeur par d&eacute;faut au cas o&ugrave; rien n'est &eacute;crit.</p></section><section class="chapter"><h3 id="explication-de-la-notion_1" data-toc="explication-de-la-notion_1">Explication de la notion</h3><p id="-cxtpn1_66">Le syst&egrave;me g&egrave;re un fichier XML pour votre application o&ugrave; ces donn&eacute;es sont stock&eacute;es. L'acc&egrave;s se fait via l'objet <code class="code" id="-cxtpn1_75">Context</code>.</p><p id="-cxtpn1_67"><span class="control" id="-cxtpn1_76">1. Obtenir une instance de SharedPreferences</span></p><div class="code-block" data-lang="kotlin">
// Dans une Activity ou un Fragment, `this` ou `requireContext()` est un Context
val sharedPref = activity?.getSharedPreferences(
    &quot;fr.formation.myapp.PREFERENCE_FILE_KEY&quot;, // Nom unique pour votre fichier de prefs
    Context.MODE_PRIVATE // Mode privé: seul votre app peut y accéder
)
</div><p id="-cxtpn1_69"><span class="control" id="-cxtpn1_77">2. &Eacute;crire des donn&eacute;es</span> L'&eacute;criture se fait via un <code class="code" id="-cxtpn1_78">Editor</code>.</p><div class="code-block" data-lang="kotlin">
val editor = sharedPref.edit()
editor.putString(&quot;username_key&quot;, &quot;Alice&quot;)
editor.putInt(&quot;highscore_key&quot;, 1000)
editor.putBoolean(&quot;dark_mode_enabled_key&quot;, true)

// Pour valider les changements
editor.apply() // Asynchrone, recommandé
// ou
// editor.commit() // Synchrone, plus rare, renvoie un boolean
</div><ul class="list _bullet" id="-cxtpn1_71"><li class="list__item" id="-cxtpn1_79"><p id="-cxtpn1_81"><span class="control" id="-cxtpn1_82"><code class="code" id="-cxtpn1_84">apply()</code></span>: Modifie les SharedPreferences en m&eacute;moire imm&eacute;diatement mais &eacute;crit sur le disque de mani&egrave;re * <span class="emphasis" id="-cxtpn1_83">asynchrone</span>*. Ne renvoie pas de confirmation. C'est la m&eacute;thode &agrave; privil&eacute;gier dans 99% des cas car elle ne bloque pas le thread principal.</p></li><li class="list__item" id="-cxtpn1_80"><p id="-cxtpn1_85"><span class="control" id="-cxtpn1_86"><code class="code" id="-cxtpn1_89">commit()</code></span>: &Eacute;crit les donn&eacute;es sur le disque de mani&egrave;re <span class="control" id="-cxtpn1_87">synchrone</span>. Bloque le thread principal jusqu'&agrave; ce que l'&eacute;criture soit termin&eacute;e. Renvoie <code class="code" id="-cxtpn1_88">true</code> si l'&eacute;criture a r&eacute;ussi. &Agrave; n'utiliser que si vous avez besoin de savoir imm&eacute;diatement si l'&eacute;criture a fonctionn&eacute;.</p></li></ul><p id="-cxtpn1_72"><span class="control" id="-cxtpn1_90">3. Lire des donn&eacute;es</span> La lecture est directe. Il faut toujours fournir une <span class="control" id="-cxtpn1_91">valeur par d&eacute;faut</span> au cas o&ugrave; la cl&eacute; n'existe pas.</p><div class="code-block" data-lang="kotlin">
val username = sharedPref.getString(&quot;username_key&quot;, &quot;Guest&quot;) // &quot;Guest&quot; si la clé n'existe pas
val highscore = sharedPref.getInt(&quot;highscore_key&quot;, 0)
val isDarkMode = sharedPref.getBoolean(&quot;dark_mode_enabled_key&quot;, false)
</div><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="524px" preserveAspectRatio="none" style="width:486px;height:524px;background:#FFFFFF;" version="1.1" viewBox="0 0 486 524" width="486px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="350" x="67.25" y="28.5352">Flux d'&#233;criture et lecture dans SharedPreferences</text><rect fill="#FFFFFF" height="117.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="180.5" y="150.2871"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="180.5" y="337.7949"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="118.9766" y2="275.5293"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="23" x2="23" y1="275.5293" y2="316.4844"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="316.4844" y2="443.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="185.5" x2="185.5" y1="118.9766" y2="275.5293"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="185.5" x2="185.5" y1="275.5293" y2="316.4844"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="185.5" x2="185.5" y1="316.4844" y2="443.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="409.5" x2="409.5" y1="118.9766" y2="275.5293"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="409.5" x2="409.5" y1="275.5293" y2="316.4844"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="409.5" x2="409.5" y1="316.4844" y2="443.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="116.0234">User</text><ellipse cx="23.5" cy="50.9883" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,58.9883 L23.5,85.9883 M10.5,66.9883 L36.5,66.9883 M23.5,85.9883 L10.5,100.9883 M23.5,85.9883 L36.5,100.9883 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="456.2617">User</text><ellipse cx="23.5" cy="467.7148" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,475.7148 L23.5,502.7148 M10.5,483.7148 L36.5,483.7148 M23.5,502.7148 L10.5,517.7148 M23.5,502.7148 L36.5,517.7148 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80" x="145.5" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="152.5" y="108.0234">Fragment</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80" x="145.5" y="442.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="152.5" y="463.2617">Fragment</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="142" x="338.5" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="345.5" y="108.0234">SharedPreferences</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="142" x="338.5" y="442.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="345.5" y="463.2617">SharedPreferences</text><rect fill="#FFFFFF" height="117.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="180.5" y="150.2871"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="180.5" y="337.7949"/><polygon fill="#181818" points="168.5,146.2871,178.5,150.2871,168.5,154.2871,172.5,150.2871" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="23.5" x2="174.5" y1="150.2871" y2="150.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="30.5" y="145.5449">Coche "Mode Sombre"</text><polygon fill="#181818" points="397.5,175.5977,407.5,179.5977,397.5,183.5977,401.5,179.5977" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="190.5" x2="403.5" y1="179.5977" y2="179.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="197.5" y="174.8555">getSharedPreferences()</text><polygon fill="#181818" points="397.5,204.9082,407.5,208.9082,397.5,212.9082,401.5,208.9082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="190.5" x2="403.5" y1="208.9082" y2="208.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="197.5" y="204.166">edit()</text><polygon fill="#181818" points="397.5,234.2188,407.5,238.2188,397.5,242.2188,401.5,238.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="190.5" x2="403.5" y1="238.2188" y2="238.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="197.5" y="233.4766">putBoolean("dark_mode", true)</text><polygon fill="#181818" points="397.5,263.5293,407.5,267.5293,397.5,271.5293,401.5,267.5293" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="185.5" x2="403.5" y1="267.5293" y2="267.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="192.5" y="262.7871">apply()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="48" x="192.5" y="300.1641">plus tard</text><polygon fill="#181818" points="168.5,333.7949,178.5,337.7949,168.5,341.7949,172.5,337.7949" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="23.5" x2="174.5" y1="337.7949" y2="337.7949"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="30.5" y="333.0527">Relance l'application</text><polygon fill="#181818" points="397.5,363.1055,407.5,367.1055,397.5,371.1055,401.5,367.1055" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="190.5" x2="403.5" y1="367.1055" y2="367.1055"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="197.5" y="362.3633">getSharedPreferences()</text><polygon fill="#181818" points="397.5,392.416,407.5,396.416,397.5,400.416,401.5,396.416" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="190.5" x2="403.5" y1="396.416" y2="396.416"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="197.5" y="391.6738">getBoolean("dark_mode", false)</text><polygon fill="#181818" points="196.5,421.7266,186.5,425.7266,196.5,429.7266,192.5,425.7266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="190.5" x2="408.5" y1="425.7266" y2="425.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="202.5" y="420.9844">Renvoie `true`</text><!--SRC=[hOynJWCn44LxdsAqJO94zW0K522bGrgneau6-oUnyDhMU3OAH-8SN0mlHH3ibdGpe____ATU0sWRnWkvrUU75Q-ZWA0KOBz7nx5GVsA1wmG72A95COQj9g6N0Z6PHRtrcQFILlWu8EgluynEN3CxOoOxRUwlBhgZnsHFeEOfEL2VXbT1C_toPrRyf5yDrTntrNQ4phwiR-OwEAzBzppgGqe17DUDOtdR3RL0Sqig8nRad7DuhpaEyswcRLlAOIoaB8xgjWZwZC2r9ONL5EOjgq_nFr6hRX7fmA5KfghP_6qKpyc3zXFqVedj2m00]--></g></svg></div></section><section class="chapter"><h3 id="exercice-1-sauvegarder-et-restaurer-le-nom-de-l-utilisateur" data-toc="exercice-1-sauvegarder-et-restaurer-le-nom-de-l-utilisateur">Exercice 1 : Sauvegarder et restaurer le nom de l'utilisateur</h3><p id="-cxtpn1_92"><span class="control" id="-cxtpn1_100">&Eacute;nonc&eacute; :</span> Cr&eacute;ez une interface simple avec un <code class="code" id="-cxtpn1_101">EditText</code>, un bouton &quot;Sauvegarder&quot;, et un <code class="code" id="-cxtpn1_102">TextView</code>.</p><ol class="list _decimal" id="-cxtpn1_93" type="1"><li class="list__item" id="-cxtpn1_103"><p id="-cxtpn1_105">Quand l'utilisateur clique sur &quot;Sauvegarder&quot;, sauvegardez le nom entr&eacute; dans les <code class="code" id="-cxtpn1_106">SharedPreferences</code>.</p></li><li class="list__item" id="-cxtpn1_104"><p id="-cxtpn1_107">Au d&eacute;marrage de l'application (<code class="code" id="-cxtpn1_108">onCreate</code>), lisez le nom depuis les <code class="code" id="-cxtpn1_109">SharedPreferences</code> et, s'il existe, affichez-le dans le <code class="code" id="-cxtpn1_110">TextView</code> avec un message de bienvenue.</p></li></ol><p id="-cxtpn1_94"><span class="control" id="-cxtpn1_111">Correction exercice 1</span></p><p id="-cxtpn1_95"><span class="control" id="-cxtpn1_112">1. <code class="code" id="-cxtpn1_113">activity_main.xml</code></span></p><div class="code-block" data-lang="markup">

&lt;LinearLayout
        xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot;
        android:orientation=&quot;vertical&quot;
        android:padding=&quot;16dp&quot;&gt;

    &lt;EditText
            android:id=&quot;@+id/nameEditText&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:hint=&quot;Entrez votre nom&quot;/&gt;

    &lt;Button
            android:id=&quot;@+id/saveButton&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;Sauvegarder&quot;/&gt;

    &lt;TextView
            android:id=&quot;@+id/welcomeTextView&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_marginTop=&quot;20dp&quot;
            android:text=&quot;Bienvenue !&quot;/&gt;
&lt;/LinearLayout&gt;
</div><p id="-cxtpn1_97"><span class="control" id="-cxtpn1_114">2. <code class="code" id="-cxtpn1_115">MainActivity.kt</code></span></p><div class="code-block" data-lang="kotlin">
package fr.formation.sharedprefs

import android.content.Context
import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import fr.formation.sharedprefs.databinding.ActivityMainBinding

// On définit nos clés comme des constantes pour éviter les fautes de frappe
private const val PREFS_NAME = &quot;fr.formation.sharedprefs.user_prefs&quot;
private const val KEY_USERNAME = &quot;username&quot;

class MainActivity : AppCompatActivity() {
    private lateinit var binding: ActivityMainBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)

        // On charge les préférences au démarrage
        loadData()

        binding.saveButton.setOnClickListener {
            saveData()
        }
    }

    private fun saveData() {
        // 1. Obtenir une instance de SharedPreferences
        val sharedPref = getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE)

        // 2. Écrire les données
        with(sharedPref.edit()) {
            putString(KEY_USERNAME, binding.nameEditText.text.toString())
            apply() // On utilise apply()
        }
    }

    private fun loadData() {
        // 1. Obtenir une instance de SharedPreferences
        val sharedPref = getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE)

        // 2. Lire la donnée avec une valeur par défaut
        val savedUsername = sharedPref.getString(KEY_USERNAME, null)

        // 3. Mettre à jour l'UI si une valeur a été trouvée
        if (savedUsername != null) {
            binding.welcomeTextView.text = &quot;Bienvenue, $savedUsername !&quot;
            binding.nameEditText.setText(savedUsername)
        }
    }
}
</div></section></section><section class="chapter"><h2 id="tp-10-un-interrupteur-de-r-glages-persistants" data-toc="tp-10-un-interrupteur-de-r-glages-persistants">TP 10 : Un interrupteur de r&eacute;glages persistants</h2><p id="-cxtpn1_116"><span class="control" id="-cxtpn1_119">Objectif :</span> Cr&eacute;er un &eacute;cran de r&eacute;glages simple avec un interrupteur (Switch) pour activer/d&eacute;sactiver une fonctionnalit&eacute; (par exemple, les notifications). L'&eacute;tat de l'interrupteur doit &ecirc;tre sauvegard&eacute; et restaur&eacute; &agrave; chaque lancement de l'application.</p><section class="procedure-steps" id="-cxtpn1_117"><ol class="list _decimal" id="-cxtpn1_120" type="1"><li class="list__item" id="-cxtpn1_121"><p id="-cxtpn1_125"><span class="control" id="-cxtpn1_127">Cr&eacute;ez le layout :</span></p><ul class="list _bullet" id="-cxtpn1_126"><li class="list__item" id="-cxtpn1_128"><p id="-cxtpn1_130">Utilisez un <code class="code" id="-cxtpn1_131">androidx.appcompat.widget.SwitchCompat</code> dans votre layout.</p></li><li class="list__item" id="-cxtpn1_129"><p id="-cxtpn1_132">Ajoutez un <code class="code" id="-cxtpn1_133">TextView</code> &agrave; c&ocirc;t&eacute; pour d&eacute;crire le r&eacute;glage (&quot;Activer les notifications&quot;).</p></li></ul></li><li class="list__item" id="-cxtpn1_122"><p id="-cxtpn1_134"><span class="control" id="-cxtpn1_136">Dans <code class="code" id="-cxtpn1_137">onCreate</code>:</span></p><ul class="list _bullet" id="-cxtpn1_135"><li class="list__item" id="-cxtpn1_138"><p id="-cxtpn1_140">Appelez une fonction <code class="code" id="-cxtpn1_141">loadSettings()</code> qui va lire la valeur bool&eacute;enne associ&eacute;e &agrave; l'&eacute;tat des notifications depuis les <code class="code" id="-cxtpn1_142">SharedPreferences</code>. La valeur par d&eacute;faut doit &ecirc;tre <code class="code" id="-cxtpn1_143">true</code> (activ&eacute;).</p></li><li class="list__item" id="-cxtpn1_139"><p id="-cxtpn1_144">Utilisez cette valeur pour d&eacute;finir l'&eacute;tat initial de votre <code class="code" id="-cxtpn1_145">SwitchCompat</code> (<code class="code" id="-cxtpn1_146">mySwitch.isChecked = savedValue</code>).</p></li></ul></li><li class="list__item" id="-cxtpn1_123"><p id="-cxtpn1_147"><span class="control" id="-cxtpn1_149">G&eacute;rez l'interaction :</span></p><ul class="list _bullet" id="-cxtpn1_148"><li class="list__item" id="-cxtpn1_150"><p id="-cxtpn1_152">Ajoutez un &eacute;couteur sur le <code class="code" id="-cxtpn1_153">SwitchCompat</code> avec <code class="code" id="-cxtpn1_154">setOnCheckedChangeListener</code>.</p></li><li class="list__item" id="-cxtpn1_151"><p id="-cxtpn1_155">&Agrave; l'int&eacute;rieur de cet &eacute;couteur, appelez une fonction <code class="code" id="-cxtpn1_156">saveSettings(isChecked: Boolean)</code> qui sauvegarde le nouvel &eacute;tat de l'interrupteur dans les <code class="code" id="-cxtpn1_157">SharedPreferences</code>.</p></li></ul></li><li class="list__item" id="-cxtpn1_124"><p id="-cxtpn1_158"><span class="control" id="-cxtpn1_160">Testez :</span></p><ul class="list _bullet" id="-cxtpn1_159"><li class="list__item" id="-cxtpn1_161"><p id="-cxtpn1_165">Lancez l'application. L'interrupteur est activ&eacute;.</p></li><li class="list__item" id="-cxtpn1_162"><p id="-cxtpn1_166">D&eacute;sactivez-le.</p></li><li class="list__item" id="-cxtpn1_163"><p id="-cxtpn1_167">Fermez compl&egrave;tement l'application (en la &quot;swipant&quot; depuis les applications r&eacute;centes).</p></li><li class="list__item" id="-cxtpn1_164"><p id="-cxtpn1_168">Relancez l'application. L'interrupteur doit &ecirc;tre rest&eacute; dans l'&eacute;tat d&eacute;sactiv&eacute;.</p></li></ul></li></ol><ol class="list _decimal"></ol></section></section><section class="chapter"><h2 id="auto-valuation" data-toc="auto-valuation">Auto-&eacute;valuation</h2><p id="-cxtpn1_169"><span class="control" id="-cxtpn1_177">1. Dans quel cas est-il pr&eacute;f&eacute;rable d'utiliser <code class="code" id="-cxtpn1_178">SharedPreferences</code> plut&ocirc;t qu'une base de donn&eacute;es <code class="code" id="-cxtpn1_179">Room</code>? (QCM)</span></p><ul class="list _bullet" id="-cxtpn1_170"><li class="list__item" id="-cxtpn1_180"><p id="-cxtpn1_184">A) Pour stocker une liste de 10 000 produits.</p></li><li class="list__item" id="-cxtpn1_181"><p id="-cxtpn1_185">B) Pour stocker la pr&eacute;f&eacute;rence de l'utilisateur pour le mode sombre.</p></li><li class="list__item" id="-cxtpn1_182"><p id="-cxtpn1_186">C) Pour stocker les messages d'une conversation de chat.</p></li><li class="list__item" id="-cxtpn1_183"><p id="-cxtpn1_187">D) Pour stocker des donn&eacute;es qui ont des relations entre elles.</p></li></ul><p id="-cxtpn1_171"><span class="control" id="-cxtpn1_188">2. Quelle est la principale diff&eacute;rence entre <code class="code" id="-cxtpn1_189">editor.commit()</code> et <code class="code" id="-cxtpn1_190">editor.apply()</code>? (QCM)</span></p><ul class="list _bullet" id="-cxtpn1_172"><li class="list__item" id="-cxtpn1_191"><p id="-cxtpn1_195">A) <code class="code" id="-cxtpn1_196">commit()</code> est asynchrone, <code class="code" id="-cxtpn1_197">apply()</code> est synchrone.</p></li><li class="list__item" id="-cxtpn1_192"><p id="-cxtpn1_198">B) <code class="code" id="-cxtpn1_199">commit()</code> est la m&eacute;thode moderne, <code class="code" id="-cxtpn1_200">apply()</code> est obsol&egrave;te.</p></li><li class="list__item" id="-cxtpn1_193"><p id="-cxtpn1_201">C) <code class="code" id="-cxtpn1_202">commit()</code> bloque le thread principal, <code class="code" id="-cxtpn1_203">apply()</code> ne le bloque pas.</p></li><li class="list__item" id="-cxtpn1_194"><p id="-cxtpn1_204">D) <code class="code" id="-cxtpn1_205">commit()</code> ne peut sauvegarder que des <code class="code" id="-cxtpn1_206">String</code>, <code class="code" id="-cxtpn1_207">apply()</code> peut tout sauvegarder.</p></li></ul><p id="-cxtpn1_173"><span class="control" id="-cxtpn1_208">3. Qu'est-ce que le deuxi&egrave;me argument de la m&eacute;thode <code class="code" id="-cxtpn1_209">sharedPref.getString(&quot;ma_cle&quot;, &quot;valeur_par_defaut&quot;)</code>? (QCM)</span></p><ul class="list _bullet" id="-cxtpn1_174"><li class="list__item" id="-cxtpn1_210"><p id="-cxtpn1_214">A) La valeur &agrave; sauvegarder.</p></li><li class="list__item" id="-cxtpn1_211"><p id="-cxtpn1_215">B) Le nom du fichier de pr&eacute;f&eacute;rences.</p></li><li class="list__item" id="-cxtpn1_212"><p id="-cxtpn1_216">C) La valeur &agrave; retourner si la cl&eacute; &quot;ma_cle&quot; n'est pas trouv&eacute;e.</p></li><li class="list__item" id="-cxtpn1_213"><p id="-cxtpn1_217">D) Un message d'erreur &agrave; afficher.</p></li></ul><p id="-cxtpn1_175"><span class="control" id="-cxtpn1_218">4. Pourquoi est-il consid&eacute;r&eacute; comme une bonne pratique de d&eacute;finir les cl&eacute;s des SharedPreferences (<code class="code" id="-cxtpn1_219">&quot;username_key&quot;</code>) comme des constantes ? (Question ouverte)</span></p><p id="-cxtpn1_176"><span class="control" id="-cxtpn1_220">5. Si vous deviez sauvegarder la date et l'heure de la derni&egrave;re ouverture de l'application, quel type de donn&eacute;e utiliseriez-vous et comment le stockeriez-vous dans les SharedPreferences ? (Question ouverte)</span></p></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h2 id="correction-de-l-auto-valuation" data-toc="correction-de-l-auto-valuation">Correction de l'auto-&eacute;valuation</h2></div><div class="collapse__content"><p id="-cxtpn1_221"><span class="control" id="-cxtpn1_232">1. Quand utiliser <code class="code" id="-cxtpn1_233">SharedPreferences</code>?</span></p><ul class="list _bullet" id="-cxtpn1_222"><li class="list__item" id="-cxtpn1_234"><p id="-cxtpn1_236"><span class="control" id="-cxtpn1_237">R&eacute;ponse : B) Pour stocker la pr&eacute;f&eacute;rence de l'utilisateur pour le mode sombre.</span></p></li><li class="list__item" id="-cxtpn1_235"><p id="-cxtpn1_238"><span class="control" id="-cxtpn1_239">Justification :</span> C'est une donn&eacute;e simple, une paire cl&eacute;-valeur (ex: &quot;dark_mode_enabled&quot;: true), ce qui est le cas d'usage parfait pour les <code class="code" id="-cxtpn1_240">SharedPreferences</code>. Les autres options impliquent des donn&eacute;es complexes ou volumineuses, qui n&eacute;cessitent une base de donn&eacute;es.</p></li></ul><p id="-cxtpn1_223"><span class="control" id="-cxtpn1_241">2. Diff&eacute;rence entre <code class="code" id="-cxtpn1_242">commit()</code> et <code class="code" id="-cxtpn1_243">apply()</code>?</span></p><ul class="list _bullet" id="-cxtpn1_224"><li class="list__item" id="-cxtpn1_244"><p id="-cxtpn1_246"><span class="control" id="-cxtpn1_247">R&eacute;ponse : C) <code class="code" id="-cxtpn1_248">commit()</code> bloque le thread principal, <code class="code" id="-cxtpn1_249">apply()</code> ne le bloque pas.</span></p></li><li class="list__item" id="-cxtpn1_245"><p id="-cxtpn1_250"><span class="control" id="-cxtpn1_251">Justification :</span> <code class="code" id="-cxtpn1_252">commit()</code> est synchrone et effectue l'&eacute;criture sur le disque sur le m&ecirc;me thread, ce qui peut causer des freezes de l'UI. <code class="code" id="-cxtpn1_253">apply()</code> est asynchrone, l'&eacute;criture se fait en arri&egrave;re-plan, ce qui est beaucoup plus s&ucirc;r pour les performances de l'application.</p></li></ul><p id="-cxtpn1_225"><span class="control" id="-cxtpn1_254">3. Que repr&eacute;sente le deuxi&egrave;me argument de <code class="code" id="-cxtpn1_255">getString()</code>?</span></p><ul class="list _bullet" id="-cxtpn1_226"><li class="list__item" id="-cxtpn1_256"><p id="-cxtpn1_258"><span class="control" id="-cxtpn1_259">R&eacute;ponse : C) La valeur &agrave; retourner si la cl&eacute; &quot;ma_cle&quot; n'est pas trouv&eacute;e.</span></p></li><li class="list__item" id="-cxtpn1_257"><p id="-cxtpn1_260"><span class="control" id="-cxtpn1_261">Justification :</span> C'est la valeur par d&eacute;faut. C'est une mesure de s&eacute;curit&eacute; essentielle pour &eacute;viter de recevoir <code class="code" id="-cxtpn1_262">null</code> et de provoquer un <code class="code" id="-cxtpn1_263">NullPointerException</code> si on essaie de lire une pr&eacute;f&eacute;rence qui n'a pas encore &eacute;t&eacute; sauvegard&eacute;e.</p></li></ul><p id="-cxtpn1_227"><span class="control" id="-cxtpn1_264">4. Pourquoi utiliser des constantes pour les cl&eacute;s ?</span></p><ul class="list _bullet" id="-cxtpn1_228"><li class="list__item" id="-cxtpn1_265"><p id="-cxtpn1_266"><span class="control" id="-cxtpn1_267">R&eacute;ponse type :</span> Pour &eacute;viter les erreurs de frappe. Si vous &eacute;crivez <code class="code" id="-cxtpn1_268">&quot;username_key&quot;</code> &agrave; un endroit et <code class="code" id="-cxtpn1_269">&quot;user_name_key&quot;</code> &agrave; un autre, le syst&egrave;me les traitera comme deux cl&eacute;s diff&eacute;rentes. En utilisant une constante (<code class="code" id="-cxtpn1_270">private const val KEY_USERNAME = &quot;username_key&quot;</code>), vous &ecirc;tes s&ucirc;r d'utiliser exactement la m&ecirc;me cha&icirc;ne partout, et si vous devez la changer, vous n'avez qu'un seul endroit &agrave; modifier.</p></li></ul><p id="-cxtpn1_229"><span class="control" id="-cxtpn1_271">5. Comment sauvegarder la date et l'heure ?</span></p><ul class="list _bullet" id="-cxtpn1_230"><li class="list__item" id="-cxtpn1_272"><p id="-cxtpn1_273"><span class="control" id="-cxtpn1_274">R&eacute;ponse type :</span> Les <code class="code" id="-cxtpn1_275">SharedPreferences</code> ne peuvent pas stocker directement un objet <code class="code" id="-cxtpn1_276">Date</code>. La meilleure approche est de convertir la date/heure en un type de donn&eacute;e primitif. Le plus courant est de la stocker sous forme de <code class="code" id="-cxtpn1_277">Long</code> repr&eacute;sentant le nombre de millisecondes depuis l'&eacute;poque Unix (timestamp). On obtiendrait ce timestamp avec <code class="code" id="-cxtpn1_278">System.currentTimeMillis()</code>, puis on le sauvegarderait avec <code class="code" id="-cxtpn1_279">editor.putLong(&quot;last_open_timestamp&quot;, timestamp)</code>. Pour le relire, on r&eacute;cup&eacute;rerait le <code class="code" id="-cxtpn1_280">Long</code> et on le reconvertirait en objet <code class="code" id="-cxtpn1_281">Date</code>.</p></li></ul></div></div></section><section class="chapter"><h2 id="conclusion-du-module" data-toc="conclusion-du-module">Conclusion du module</h2><p id="-cxtpn1_282">Vous savez maintenant comment donner une m&eacute;moire &agrave; court terme et pour des donn&eacute;es simples &agrave; votre application. Les <code class="code" id="-cxtpn1_284">SharedPreferences</code> sont un outil que vous utiliserez constamment pour g&eacute;rer les petits d&eacute;tails qui rendent une application personnalis&eacute;e et agr&eacute;able &agrave; utiliser.</p><p id="-cxtpn1_283">Cependant, le &quot;post-it&quot; a ses limites. Que se passe-t-il lorsque nous devons g&eacute;rer une collection d'objets structur&eacute;s, comme une liste de contacts, de produits ou de notes ? Pour cela, il nous faut une solution plus robuste et organis&eacute;e : une base de donn&eacute;es. Dans le prochain module, nous allons d&eacute;couvrir <code class="code" id="-cxtpn1_285">Room</code>, la biblioth&egrave;que recommand&eacute;e par Google pour g&eacute;rer une base de donn&eacute;es SQL locale de mani&egrave;re simple et moderne.</p></section><div class="last-modified">30 octobre 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="004-partie-04.html" class="navigation-links__prev">Partie 4 : Gestion des Donn&eacute;es</a><a href="004-02-module-11.html" class="navigation-links__next">Module 11 : G&eacute;rer une Base de Donn&eacute;es Locale avec `Room`</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>