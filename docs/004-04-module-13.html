<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-11-07T11:26:39.052285"><title>Module 13 : Communiquer avec le Monde Ext&eacute;rieur (API REST &amp; `Retrofit`) | Android</title><script type="application/json" id="virtual-toc-data">[{"id":"objectifs-p-dagogiques","level":0,"title":"Objectifs pédagogiques","anchor":"#objectifs-p-dagogiques"},{"id":"introduction","level":0,"title":"Introduction","anchor":"#introduction"},{"id":"notions-abord-es","level":0,"title":"Notions abordées","anchor":"#notions-abord-es"},{"id":"principes-d-une-api-rest","level":0,"title":"Principes d\u0027une API REST","anchor":"#principes-d-une-api-rest"},{"id":"retrofit-le-client-http-de-r-f-rence","level":0,"title":"Retrofit : Le client HTTP de référence","anchor":"#retrofit-le-client-http-de-r-f-rence"},{"id":"int-gration-avec-les-coroutines-kotlin","level":0,"title":"Intégration avec les Coroutines Kotlin","anchor":"#int-gration-avec-les-coroutines-kotlin"},{"id":"tp-13-application-dog-facts","level":0,"title":"TP 13 : Application \"Dog Facts\"","anchor":"#tp-13-application-dog-facts"},{"id":"correction-du-tp-13","level":0,"title":"Correction du TP 13","anchor":"#correction-du-tp-13"},{"id":"auto-valuation","level":0,"title":"Auto-évaluation","anchor":"#auto-valuation"},{"id":"conclusion-du-module","level":0,"title":"Conclusion du module","anchor":"#conclusion-du-module"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Module 13 : Communiquer avec le Monde Ext&eacute;rieur (API REST &amp; `Retrofit`) | Android"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Android Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/004-04-module-13.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Module 13 : Communiquer avec le Monde Ext&eacute;rieur (API REST &amp; `Retrofit`) | Android"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/004-04-module-13.html#webpage",
    "url": "writerside-documentation/004-04-module-13.html",
    "name": "Module 13 : Communiquer avec le Monde Ext&eacute;rieur (API REST &amp; `Retrofit`) | Android",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Android Help"
}</script><!-- End Schema.org --></head><body data-id="004-04-module-13" data-main-title="Module 13 : Communiquer avec le Monde Extérieur (API REST & `Retrofit`)" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="004-partie-04.md|Partie 4 : Gestion des Données"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Android  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="004-04-module-13" id="004-04-module-13.md">Module 13 : Communiquer avec le Monde Extérieur (API REST & `Retrofit`)</h1><section class="chapter"><h2 id="objectifs-p-dagogiques" data-toc="objectifs-p-dagogiques">Objectifs p&eacute;dagogiques</h2><p id="x0cmp9_14">&Agrave; la fin de ce module, vous serez capable de :</p><ul class="list _bullet" id="x0cmp9_15"><li class="list__item" id="x0cmp9_16"><p id="x0cmp9_21">Comprendre les principes de base d'une API REST et du format JSON.</p></li><li class="list__item" id="x0cmp9_17"><p id="x0cmp9_22">D&eacute;finir ce qu'est <code class="code" id="x0cmp9_23">Retrofit</code> et pourquoi c'est la biblioth&egrave;que de r&eacute;f&eacute;rence pour le networking sur Android.</p></li><li class="list__item" id="x0cmp9_18"><p id="x0cmp9_24">Cr&eacute;er une interface de service <code class="code" id="x0cmp9_25">Retrofit</code> avec des annotations (<code class="code" id="x0cmp9_26">@GET</code>, <code class="code" id="x0cmp9_27">@Path</code>, <code class="code" id="x0cmp9_28">@Query</code>).</p></li><li class="list__item" id="x0cmp9_19"><p id="x0cmp9_29">Configurer une instance de <code class="code" id="x0cmp9_30">Retrofit</code> avec un convertisseur JSON (Moshi/Gson).</p></li><li class="list__item" id="x0cmp9_20"><p id="x0cmp9_31">Int&eacute;grer <code class="code" id="x0cmp9_32">Retrofit</code> avec les coroutines Kotlin pour effectuer des appels r&eacute;seau asynchrones.</p></li></ul></section><section class="chapter"><h2 id="introduction" data-toc="introduction">Introduction</h2><p id="x0cmp9_33">Imaginez que votre application est un restaurant. Jusqu'&agrave; pr&eacute;sent, vous avez cuisin&eacute; uniquement avec les ingr&eacute;dients que vous aviez dans votre propre cellier (<code class="code" id="x0cmp9_35">Room</code>). C'est bien, mais limit&eacute;. Et si vous pouviez commander des produits frais et exotiques du monde entier, livr&eacute;s directement dans votre cuisine chaque jour ? Votre menu deviendrait infiniment plus int&eacute;ressant !</p><p id="x0cmp9_34">Communiquer avec une <span class="control" id="x0cmp9_36">API REST</span>, c'est exactement &ccedil;a. Votre application passe une commande (<code class="code" id="x0cmp9_37">Requ&ecirc;te HTTP</code>) &agrave; un serveur distant, qui est comme un immense march&eacute; en ligne. Le serveur pr&eacute;pare les produits demand&eacute;s et vous les renvoie dans un format standardis&eacute; et facile &agrave; d&eacute;baller (<code class="code" id="x0cmp9_38">JSON</code>). La biblioth&egrave;que <span class="control" id="x0cmp9_39"><code class="code" id="x0cmp9_40">Retrofit</code></span> est votre service de livraison ultra-efficace. Vous lui donnez simplement votre liste de courses (une interface Kotlin), et il s'occupe de toute la logistique complexe pour passer la commande et vous livrer les produits pr&ecirc;ts &agrave; l'emploi.</p></section><section class="chapter"><h2 id="notions-abord-es" data-toc="notions-abord-es">Notions abord&eacute;es</h2><ul class="list _bullet" id="x0cmp9_41"><li class="list__item" id="x0cmp9_43"><p id="x0cmp9_46">Principes d'une API REST et du format JSON.</p></li><li class="list__item" id="x0cmp9_44"><p id="x0cmp9_47"><code class="code" id="x0cmp9_48">Retrofit</code>: Le client HTTP de r&eacute;f&eacute;rence.</p></li><li class="list__item" id="x0cmp9_45"><p id="x0cmp9_49">Int&eacute;gration avec les Coroutines Kotlin.</p></li></ul></section><section class="chapter"><h2 id="principes-d-une-api-rest" data-toc="principes-d-une-api-rest">Principes d'une API REST</h2><section class="chapter"><h3 id="introduction-la-notion" data-toc="introduction-la-notion">Introduction &agrave; la notion</h3><p id="x0cmp9_52">Une API REST est comme le menu d'un restaurant en ligne. Il vous dit exactement ce que vous pouvez commander et comment le faire. &quot;Pour avoir la liste de tous les plats du jour, faites une requ&ecirc;te <code class="code" id="x0cmp9_53">GET</code> &agrave; l'adresse <code class="code" id="x0cmp9_54">/plats-du-jour</code> &quot;. &quot;Pour ajouter une r&eacute;servation, faites une requ&ecirc;te <code class="code" id="x0cmp9_55">POST</code> &agrave; <code class="code" id="x0cmp9_56">/reservations</code> avec les d&eacute;tails du client&quot;. Le format JSON, lui, est la bo&icirc;te standard dans laquelle on vous livre vos plats, facile &agrave; ouvrir et &agrave; comprendre.</p></section><section class="chapter"><h3 id="explication-de-la-notion" data-toc="explication-de-la-notion">Explication de la notion</h3><p id="x0cmp9_57"><span class="control" id="x0cmp9_65">API (Application Programming Interface)</span>: C'est une interface qui permet &agrave; deux applications de communiquer entre elles. Dans notre cas, notre application Android (le client) et un serveur distant.</p><p id="x0cmp9_58"><span class="control" id="x0cmp9_66">REST (Representational State Transfer)</span>: C'est un style d'architecture pour la conception d'API. Il est bas&eacute; sur des principes simples :</p><ul class="list _bullet" id="x0cmp9_59"><li class="list__item" id="x0cmp9_67"><p id="x0cmp9_69"><span class="control" id="x0cmp9_70">Ressources :</span> Tout est une ressource, identifi&eacute;e par une URL (ex: <code class="code" id="x0cmp9_71">/users</code>, <code class="code" id="x0cmp9_72">/products/123</code>).</p></li><li class="list__item" id="x0cmp9_68"><p id="x0cmp9_73"><span class="control" id="x0cmp9_75">M&eacute;thodes HTTP (Verbes) :</span> On utilise les verbes HTTP standards pour interagir avec les ressources.</p><ul class="list _bullet" id="x0cmp9_74"><li class="list__item" id="x0cmp9_76"><p id="x0cmp9_80"><code class="code" id="x0cmp9_81">GET</code>: Pour r&eacute;cup&eacute;rer des donn&eacute;es (lecture).</p></li><li class="list__item" id="x0cmp9_77"><p id="x0cmp9_82"><code class="code" id="x0cmp9_83">POST</code>: Pour cr&eacute;er une nouvelle ressource.</p></li><li class="list__item" id="x0cmp9_78"><p id="x0cmp9_84"><code class="code" id="x0cmp9_85">PUT</code>/<code class="code" id="x0cmp9_86">PATCH</code>: Pour mettre &agrave; jour une ressource existante.</p></li><li class="list__item" id="x0cmp9_79"><p id="x0cmp9_87"><code class="code" id="x0cmp9_88">DELETE</code>: Pour supprimer une ressource.</p></li></ul></li></ul><p id="x0cmp9_60"><span class="control" id="x0cmp9_89">JSON (JavaScript Object Notation)</span>: C'est le format de donn&eacute;es le plus utilis&eacute; pour les &eacute;changes sur le web. Il est l&eacute;ger, lisible par les humains et facile &agrave; parser pour les machines. Il repr&eacute;sente les donn&eacute;es sous forme de paires cl&eacute;-valeur.</p><p id="x0cmp9_61"><span class="control" id="x0cmp9_90">Exemple de r&eacute;ponse JSON pour un utilisateur :</span></p><div class="code-block" data-lang="json">
{
  &quot;id&quot;: 1,
  &quot;name&quot;: &quot;Leanne Graham&quot;,
  &quot;username&quot;: &quot;Bret&quot;,
  &quot;email&quot;: &quot;Sincere@april.biz&quot;,
  &quot;address&quot;: {
    &quot;street&quot;: &quot;Kulas Light&quot;,
    &quot;suite&quot;: &quot;Apt. 556&quot;,
    &quot;city&quot;: &quot;Gwenborough&quot;,
    &quot;zipcode&quot;: &quot;92998-3874&quot;
  }
}
</div><p id="x0cmp9_63">Nous allons utiliser des <code class="code" id="x0cmp9_91">data class</code> Kotlin qui correspondent parfaitement &agrave; cette structure pour que la conversion soit automatique.</p></section></section><section class="chapter"><h2 id="retrofit-le-client-http-de-r-f-rence" data-toc="retrofit-le-client-http-de-r-f-rence"><code class="code" id="x0cmp9_96">Retrofit</code>: Le client HTTP de r&eacute;f&eacute;rence</h2><section class="chapter"><h3 id="introduction-la-notion_1" data-toc="introduction-la-notion_1">Introduction &agrave; la notion</h3><p id="x0cmp9_97">Retrofit est un traducteur magique. Vous lui donnez une simple interface Kotlin d&eacute;crivant ce que vous voulez obtenir, et il &eacute;crit pour vous tout le code complexe n&eacute;cessaire pour cr&eacute;er et envoyer des requ&ecirc;tes HTTP, puis pour parser la r&eacute;ponse JSON et la transformer en objets Kotlin que vous pouvez utiliser directement.</p></section><section class="chapter"><h3 id="explication-de-la-notion_1" data-toc="explication-de-la-notion_1">Explication de la notion</h3><p id="x0cmp9_98">Retrofit est une biblioth&egrave;que d&eacute;velopp&eacute;e par Square qui transforme votre API REST en une interface Kotlin.</p><p id="x0cmp9_99"><span class="control" id="x0cmp9_101">Les 3 &eacute;tapes pour utiliser Retrofit :</span></p><ol class="list _decimal" id="x0cmp9_100" type="1"><li class="list__item" id="x0cmp9_102"><p id="x0cmp9_105"><span class="control" id="x0cmp9_106">Mod&egrave;les de donn&eacute;es (<code class="code" id="x0cmp9_108">data class</code>) :</span> Cr&eacute;ez des <code class="code" id="x0cmp9_107">data class</code> Kotlin qui correspondent exactement &agrave; la structure du JSON que vous attendez.</p></li><li class="list__item" id="x0cmp9_103"><p id="x0cmp9_109"><span class="control" id="x0cmp9_110">Interface de service API :</span> D&eacute;finissez une interface Kotlin o&ugrave; chaque m&eacute;thode repr&eacute;sente un &quot;endpoint&quot; (une URL) de l'API. Vous utilisez des annotations Retrofit pour d&eacute;crire la requ&ecirc;te.</p></li><li class="list__item" id="x0cmp9_104"><p id="x0cmp9_111"><span class="control" id="x0cmp9_112">Instance de Retrofit :</span> Cr&eacute;ez un objet Retrofit en le configurant avec l'URL de base de l'API et un &quot; convertisseur&quot; qui saura transformer le JSON en vos <code class="code" id="x0cmp9_113">data class</code>.</p></li></ol></section><section class="chapter"><h3 id="exemple-utiliser-une-api-de-test-jsonplaceholder" data-toc="exemple-utiliser-une-api-de-test-jsonplaceholder">Exemple : Utiliser une API de test (JSONPlaceholder)</h3><p id="x0cmp9_114">Imaginons que nous voulons r&eacute;cup&eacute;rer une liste d'utilisateurs depuis l'URL <code class="code" id="x0cmp9_124">https://jsonplaceholder.typicode.com/users</code>.</p><p id="x0cmp9_115"><span class="control" id="x0cmp9_125">&Eacute;tape 1 : Ajouter les d&eacute;pendances</span> dans <code class="code" id="x0cmp9_126">build.gradle.kts</code></p><div class="code-block" data-lang="kotlin">
dependencies {
    // Retrofit
    implementation(&quot;com.squareup.retrofit2:retrofit:2.9.0&quot;)
    // Convertisseur Moshi (moderne, recommandé) ou Gson
    implementation(&quot;com.squareup.retrofit2:converter-moshi:2.9.0&quot;)
    // Moshi lui-même, avec le support de la génération de code
    implementation(&quot;com.squareup.moshi:moshi-kotlin:1.14.0&quot;)
    ksp(&quot;com.squareup.moshi:moshi-kotlin-codegen:1.14.0&quot;)
}
</div><p id="x0cmp9_117"><span class="control" id="x0cmp9_127">&Eacute;tape 2 : Cr&eacute;er les <code class="code" id="x0cmp9_128">data class</code></span></p><div class="code-block" data-lang="kotlin">
package fr.formation.retrofit.models

import com.squareup.moshi.Json

// L'annotation @JsonClass est nécessaire pour que Moshi génère l'adapter
@JsonClass(generateAdapter = true)
data class User(
    @Json(name = &quot;id&quot;) // L'annotation @Json est optionnelle si les noms correspondent
    val id: Long,
    @Json(name = &quot;name&quot;)
    val name: String,
    @Json(name = &quot;email&quot;)
    val email: String
)
</div><p id="x0cmp9_119"><span class="control" id="x0cmp9_129">&Eacute;tape 3 : Cr&eacute;er l'interface de service</span></p><div class="code-block" data-lang="kotlin">
package fr.formation.retrofit.api

import fr.formation.retrofit.models.User
import retrofit2.http.GET
import retrofit2.http.Path

interface ApiService {
    // La fonction est `suspend` pour être utilisée avec les coroutines
    @GET(&quot;users&quot;) // Endpoint relatif à l'URL de base
    suspend fun getUsers(): List&lt;User&gt;

    // Exemple avec un paramètre dans l'URL
    @GET(&quot;users/{id}&quot;) // ex: &quot;users/1&quot;
    suspend fun getUserById(@Path(&quot;id&quot;) userId: Long): User
}
</div><p id="x0cmp9_121"><span class="control" id="x0cmp9_130">&Eacute;tape 4 : Cr&eacute;er l'instance de Retrofit (souvent dans un objet Singleton)</span></p><div class="code-block" data-lang="kotlin">
package fr.formation.retrofit.api

import com.squareup.moshi.Moshi
import com.squareup.moshi.kotlin.reflect.KotlinJsonAdapterFactory
import retrofit2.Retrofit
import retrofit2.converter.moshi.MoshiConverterFactory

object RetrofitClient {
    private const val BASE_URL = &quot;https://jsonplaceholder.typicode.com/&quot;

    // Configuration de Moshi pour qu'il fonctionne avec Kotlin
    private val moshi = Moshi.Builder()
        .add(KotlinJsonAdapterFactory())
        .build()

    // Création de l'instance de Retrofit
    private val retrofit = Retrofit.Builder()
        .baseUrl(BASE_URL)
        .addConverterFactory(MoshiConverterFactory.create(moshi))
        .build()

    // Création de l'implémentation de notre interface de service
    val apiService: ApiService by lazy {
        retrofit.create(ApiService::class.java)
    }
}
</div></section></section><section class="chapter"><h2 id="int-gration-avec-les-coroutines-kotlin" data-toc="int-gration-avec-les-coroutines-kotlin">Int&eacute;gration avec les Coroutines Kotlin</h2><section class="chapter"><h3 id="introduction-la-notion_2" data-toc="introduction-la-notion_2">Introduction &agrave; la notion</h3><p id="x0cmp9_135">Comme les op&eacute;rations de base de donn&eacute;es, les appels r&eacute;seau sont lents et impr&eacute;visibles. Ils d&eacute;pendent de la qualit&eacute; de la connexion de l'utilisateur. Les coroutines sont l'outil parfait pour g&eacute;rer cette attente sans jamais geler l' application.</p></section><section class="chapter"><h3 id="explication-de-la-notion_2" data-toc="explication-de-la-notion_2">Explication de la notion</h3><p id="x0cmp9_136">En d&eacute;clarant nos m&eacute;thodes d'API comme <code class="code" id="x0cmp9_140">suspend fun</code>, Retrofit s'int&egrave;gre nativement avec les coroutines.</p><ul class="list _bullet" id="x0cmp9_137"><li class="list__item" id="x0cmp9_141"><p id="x0cmp9_144">Quand vous appelez une m&eacute;thode <code class="code" id="x0cmp9_145">suspend</code> de votre service, Retrofit effectue l'appel r&eacute;seau en arri&egrave;re-plan (sur <code class="code" id="x0cmp9_146">Dispatchers.IO</code>).</p></li><li class="list__item" id="x0cmp9_142"><p id="x0cmp9_147">La coroutine est <span class="control" id="x0cmp9_148">suspendue</span> pendant l'appel. Le thread principal est libre.</p></li><li class="list__item" id="x0cmp9_143"><p id="x0cmp9_149">Une fois la r&eacute;ponse re&ccedil;ue, la coroutine est <span class="control" id="x0cmp9_150">reprise</span> avec le r&eacute;sultat (ou une exception en cas d'erreur).</p></li></ul><p id="x0cmp9_138">Le code d'appel devient incroyablement simple et lisible, et il se place naturellement dans un <code class="code" id="x0cmp9_151">lifecycleScope.launch</code>.</p><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="359px" preserveAspectRatio="none" style="width:807px;height:359px;background:#FFFFFF;" version="1.1" viewBox="0 0 807 359" width="807px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="361" x="224.25" y="28.5352">Flux d'un appel r&#233;seau avec Retrofit et Coroutines</text><rect fill="#FFFFFF" height="200.8633" style="stroke:#181818;stroke-width:1.0;" width="10" x="307.5" y="105.2871"/><rect fill="#FFFFFF" height="136.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="466.5" y="137.5977"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="712.5" y="169.9082"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="85" x2="85" y1="73.9766" y2="324.1504"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="312" x2="312" y1="73.9766" y2="324.1504"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="471" x2="471" y1="73.9766" y2="324.1504"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="717.5" x2="717.5" y1="73.9766" y2="324.1504"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="161" x="5" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="12" y="63.0234">Fragment (UI Thread)</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="161" x="5" y="323.1504"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="12" y="343.6855">Fragment (UI Thread)</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="83" x="271" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="278" y="63.0234">Coroutine</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="83" x="271" y="323.1504"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="278" y="343.6855">Coroutine</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="439" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="446" y="63.0234">Retrofit</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="439" y="323.1504"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="446" y="343.6855">Retrofit</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118" x="658.5" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="665.5" y="63.0234">Serveur Distant</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118" x="658.5" y="323.1504"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="665.5" y="343.6855">Serveur Distant</text><rect fill="#FFFFFF" height="200.8633" style="stroke:#181818;stroke-width:1.0;" width="10" x="307.5" y="105.2871"/><rect fill="#FFFFFF" height="136.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="466.5" y="137.5977"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="712.5" y="169.9082"/><polygon fill="#181818" points="295.5,101.2871,305.5,105.2871,295.5,109.2871,299.5,105.2871" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="85.5" x2="301.5" y1="105.2871" y2="105.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="92.5" y="100.5449">lifecycleScope.launch { ... }</text><polygon fill="#181818" points="454.5,133.5977,464.5,137.5977,454.5,141.5977,458.5,137.5977" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="317.5" x2="460.5" y1="137.5977" y2="137.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="324.5" y="132.8555">apiService.getUsers()</text><path d="M481,118.2871 L481,143.2871 L776,143.2871 L776,128.2871 L766,118.2871 L481,118.2871 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M766,118.2871 L766,128.2871 L776,128.2871 L766,118.2871 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274" x="487" y="135.8555">Appel `suspend`. La coroutine se suspend.</text><polygon fill="#181818" points="700.5,165.9082,710.5,169.9082,700.5,173.9082,704.5,169.9082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="476.5" x2="706.5" y1="169.9082" y2="169.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="483.5" y="165.166">Envoie la requ&#234;te HTTP GET /users</text><polygon fill="#181818" points="487.5,195.2188,477.5,199.2188,487.5,203.2188,483.5,199.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="481.5" x2="716.5" y1="199.2188" y2="199.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="493.5" y="194.4766">Renvoie la r&#233;ponse JSON</text><line style="stroke:#181818;stroke-width:1.0;" x1="476.5" x2="518.5" y1="228.5293" y2="228.5293"/><line style="stroke:#181818;stroke-width:1.0;" x1="518.5" x2="518.5" y1="228.5293" y2="241.5293"/><line style="stroke:#181818;stroke-width:1.0;" x1="477.5" x2="518.5" y1="241.5293" y2="241.5293"/><polygon fill="#181818" points="487.5,237.5293,477.5,241.5293,487.5,245.5293,483.5,241.5293" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="483.5" y="223.7871">Parse le JSON en List&lt;User&gt;</text><polygon fill="#181818" points="328.5,269.8398,318.5,273.8398,328.5,277.8398,324.5,273.8398" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="322.5" x2="470.5" y1="273.8398" y2="273.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="334.5" y="269.0977">Retourne le r&#233;sultat</text><path d="M481,254.5293 L481,279.5293 L800,279.5293 L800,264.5293 L790,254.5293 L481,254.5293 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M790,254.5293 L790,264.5293 L800,264.5293 L790,254.5293 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298" x="487" y="272.0977">La coroutine reprend avec la liste d'utilisateurs.</text><polygon fill="#181818" points="96.5,302.1504,86.5,306.1504,96.5,310.1504,92.5,306.1504" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="90.5" x2="311.5" y1="306.1504" y2="306.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="102.5" y="301.4082">Met &#224; jour l'UI avec les donn&#233;es</text><!--SRC=[RLBBJiCm4BpxArPSe0V2lKAL49INU5HjUiTojgsHiSFQZa28V-5QVYC_nYQXUHIa7BpUtPd9U88E1k7In3V83gC5cUTeWCgjHnb15gXWZe7SIWV00EUEN0pQeXSYbnIqqhcq0GukIQvVa4z7onj8DuGo6ns0z50rXgCjHjrlg-7GZhIUsHN3aGLIWP7WGll05_LaVKT2LAnmFEdGOGn6hr2zAuCBvN9CZ8nMRU03aYI1Jo5Lq8KCs1Cakcs6QcqOiqcw8j8AapM6fKVoHwCEePLh7LUarvimXhFQs2SVVOusUqhWJe9gyJr_JISHecLYrkQ7c7Dg2wSHZ0J2rrX-C_9rcixWQfh2IQmaT09sBlmk7m_Lpx63AhUviqn-ktXy41d-GUXBwK7C9F6IQVO0BTpn6vnMHanwAtl-SyD5ilLU5R1eWWnzqdzz6zX4c1DxrEIIzHkcnIguGVEHCIBvPE_TwYYCuPxJMtx1Cqi0SyWXRJ3GG-QiBRUSw9wK5k47]--></g></svg></div></section><section class="chapter"><h3 id="exercice-1-r-cup-rer-et-afficher-une-liste-d-utilisateurs" data-toc="exercice-1-r-cup-rer-et-afficher-une-liste-d-utilisateurs">Exercice 1 : R&eacute;cup&eacute;rer et afficher une liste d'utilisateurs</h3><p id="x0cmp9_152"><span class="control" id="x0cmp9_154">&Eacute;nonc&eacute; :</span> Mettez en place tout le n&eacute;cessaire pour r&eacute;cup&eacute;rer la liste d'utilisateurs de JSONPlaceholder et l'afficher dans un <code class="code" id="x0cmp9_155">RecyclerView</code>.</p><ol class="list _decimal" id="x0cmp9_153" type="1"><li class="list__item" id="x0cmp9_156"><p id="x0cmp9_161">Suivez les 4 &eacute;tapes de l'exemple ci-dessus pour configurer Retrofit.</p></li><li class="list__item" id="x0cmp9_157"><p id="x0cmp9_162">Cr&eacute;ez une <code class="code" id="x0cmp9_163">MainActivity</code> avec un <code class="code" id="x0cmp9_164">RecyclerView</code>.</p></li><li class="list__item" id="x0cmp9_158"><p id="x0cmp9_165">Cr&eacute;ez un <code class="code" id="x0cmp9_166">UserAdapter</code> pour le <code class="code" id="x0cmp9_167">RecyclerView</code>.</p></li><li class="list__item" id="x0cmp9_159"><p id="x0cmp9_168">Dans <code class="code" id="x0cmp9_169">MainActivity</code>, utilisez <code class="code" id="x0cmp9_170">lifecycleScope.launch</code> pour appeler <code class="code" id="x0cmp9_171">RetrofitClient.apiService.getUsers()</code>.</p></li><li class="list__item" id="x0cmp9_160"><p id="x0cmp9_172">G&eacute;rez les cas de succ&egrave;s et d'erreur avec un bloc <code class="code" id="x0cmp9_173">try-catch</code>. En cas de succ&egrave;s, mettez &agrave; jour votre adapter avec la liste re&ccedil;ue.</p></li></ol></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="correction-exercice-1" data-toc="correction-exercice-1"><span class="control" id="x0cmp9_182">Correction exercice 1</span></h3></div><div class="collapse__content"><p id="x0cmp9_175"><span class="control" id="x0cmp9_183"><code class="code" id="x0cmp9_184">MainActivity.kt</code></span></p><div class="code-block" data-lang="kotlin">
package fr.formation.retrofit

import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import android.util.Log
import android.widget.Toast
import androidx.lifecycle.lifecycleScope
import androidx.recyclerview.widget.LinearLayoutManager
import fr.formation.retrofit.api.RetrofitClient
import fr.formation.retrofit.databinding.ActivityMainBinding
import java.lang.Exception

class MainActivity : AppCompatActivity() {

    private lateinit var binding: ActivityMainBinding
    private lateinit var userAdapter: UserAdapter

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)

        setupRecyclerView()
        fetchUsers()
    }

    private fun setupRecyclerView() {
        userAdapter = UserAdapter(emptyList()) // On initialise avec une liste vide
        binding.recyclerView.apply {
            layoutManager = LinearLayoutManager(this@MainActivity)
            adapter = userAdapter
        }
    }

    private fun fetchUsers() {
        lifecycleScope.launch {
            try {
                // L'appel réseau est fait en arrière-plan
                val userList = RetrofitClient.apiService.getUsers()

                // Mise à jour de l'UI sur le thread principal
                userAdapter.updateUsers(userList)

            } catch (e: Exception) {
                // Gestion de l'erreur (ex: pas de connexion)
                Log.e(&quot;MainActivity&quot;, &quot;Erreur réseau&quot;, e)
                Toast.makeText(
                    this@MainActivity,
                    &quot;Erreur: ${e.message}&quot;,
                    Toast.LENGTH_LONG
                ).show()
            }
        }
    }
}
</div><p id="x0cmp9_177"><span class="control" id="x0cmp9_185">(N'oubliez pas d'ajouter la permission Internet dans <code class="code" id="x0cmp9_186">AndroidManifest.xml</code>)</span></p><div class="code-block" data-lang="markup">

&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;
</div><p id="x0cmp9_179"><span class="control" id="x0cmp9_187">(Et l'Adapter <code class="code" id="x0cmp9_188">UserAdapter.kt</code>)</span></p><div class="code-block" data-lang="kotlin">
// ...
class UserAdapter(private var users: List&lt;User&gt;) :
    RecyclerView.Adapter&lt;UserAdapter.UserViewHolder&gt;() {
    // ... implémentation classique de l'adapter ...

    fun updateUsers(newUsers: List&lt;User&gt;) {
        users = newUsers
        notifyDataSetChanged() // Pour la simplicité, sinon utiliser DiffUtil
    }
}
</div></div></div></section></section><section class="chapter"><h2 id="tp-13-application-dog-facts" data-toc="tp-13-application-dog-facts">TP 13 : Application &quot;Dog Facts&quot;</h2><p id="x0cmp9_189"><span class="control" id="x0cmp9_194">Objectif :</span> Cr&eacute;er une application qui affiche une information al&eacute;atoire sur les chiens &agrave; chaque clic sur un bouton, en utilisant une API publique.</p><p id="x0cmp9_190">Nous allons utiliser l'API <a href="https://dog-api.kinduff.com/api/v1/facts" id="x0cmp9_195" data-external="true" rel="noopener noreferrer" target="_blank">Dog API</a>. L'endpoint qui nous int&eacute;resse est <code class="code" id="x0cmp9_196">https://dog-api.kinduff.com/api/v1/facts?number=1</code>. La r&eacute;ponse JSON ressemble &agrave; ceci :</p><div class="code-block" data-lang="json">
{
  &quot;facts&quot;: [
    &quot;La race de chien la plus ancienne, le Saluki, est originaire d'Égypte en 329 av. J.-C.&quot;
  ],
  &quot;success&quot;: true
}
</div><section class="procedure-steps" id="x0cmp9_192"><ol class="list _decimal" id="x0cmp9_197" type="1"><li class="list__item" id="x0cmp9_198"><p id="x0cmp9_203"><span class="control" id="x0cmp9_204">Configurez Retrofit</span> et Moshi, avec l'URL de base <code class="code" id="x0cmp9_205">https://dog-api.kinduff.com/</code>.</p></li><li class="list__item" id="x0cmp9_199"><p id="x0cmp9_206"><span class="control" id="x0cmp9_207">Cr&eacute;ez la <code class="code" id="x0cmp9_211">data class</code></span> <code class="code" id="x0cmp9_208">DogFactResponse</code> qui correspond &agrave; la structure JSON. Elle contiendra une <code class="code" id="x0cmp9_209">List&lt;String&gt;</code> nomm&eacute;e <code class="code" id="x0cmp9_210">facts</code>.</p></li><li class="list__item" id="x0cmp9_200"><p id="x0cmp9_212"><span class="control" id="x0cmp9_213">Cr&eacute;ez l'interface <code class="code" id="x0cmp9_216">ApiService</code></span> avec une m&eacute;thode <code class="code" id="x0cmp9_214">suspend fun getDogFact(): DogFactResponse</code>. Utilisez l'annotation <code class="code" id="x0cmp9_215">@GET(&quot;api/v1/facts?number=1&quot;)</code>.</p></li><li class="list__item" id="x0cmp9_201"><p id="x0cmp9_217"><span class="control" id="x0cmp9_218">Cr&eacute;ez le layout</span> avec un <code class="code" id="x0cmp9_219">TextView</code> pour afficher le &quot;fact&quot; et un <code class="code" id="x0cmp9_220">Button</code> pour en demander un nouveau.</p></li><li class="list__item" id="x0cmp9_202"><p id="x0cmp9_221"><span class="control" id="x0cmp9_223">Dans <code class="code" id="x0cmp9_224">MainActivity.kt</code>:</span></p><ul class="list _bullet" id="x0cmp9_222"><li class="list__item" id="x0cmp9_225"><p id="x0cmp9_232">Cr&eacute;ez une fonction <code class="code" id="x0cmp9_233">fetchNewFact()</code>.</p></li><li class="list__item" id="x0cmp9_226"><p id="x0cmp9_234">&Agrave; l'int&eacute;rieur, lancez une coroutine avec <code class="code" id="x0cmp9_235">lifecycleScope.launch</code>.</p></li><li class="list__item" id="x0cmp9_227"><p id="x0cmp9_236">Appelez votre service API.</p></li><li class="list__item" id="x0cmp9_228"><p id="x0cmp9_237">Dans un bloc <code class="code" id="x0cmp9_238">try-catch</code>, si l'appel r&eacute;ussit et que la liste <code class="code" id="x0cmp9_239">facts</code> n'est pas vide, affichez le premier &eacute;l&eacute;ment de la liste dans votre <code class="code" id="x0cmp9_240">TextView</code>.</p></li><li class="list__item" id="x0cmp9_229"><p id="x0cmp9_241">Affichez un message d'erreur en cas d'&eacute;chec.</p></li><li class="list__item" id="x0cmp9_230"><p id="x0cmp9_242">Dans <code class="code" id="x0cmp9_243">onCreate</code>, appelez <code class="code" id="x0cmp9_244">fetchNewFact()</code> une premi&egrave;re fois.</p></li><li class="list__item" id="x0cmp9_231"><p id="x0cmp9_245">Dans le <code class="code" id="x0cmp9_246">onClickListener</code> du bouton, appelez &agrave; nouveau <code class="code" id="x0cmp9_247">fetchNewFact()</code>.</p></li></ul></li></ol><ol class="list _decimal"></ol></section></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h2 id="correction-du-tp-13" data-toc="correction-du-tp-13">Correction du TP 13</h2></div><div class="collapse__content"><section class="chapter"><h3 id="tape-1-configuration-du-projet" data-toc="tape-1-configuration-du-projet">&Eacute;tape 1 : Configuration du projet</h3><section class="chapter"><h4 id="1a-d-pendances" data-toc="1a-d-pendances">1a. D&eacute;pendances</h4><p id="x0cmp9_255">Ajoutez les d&eacute;pendances suivantes &agrave; votre fichier <code class="code" id="x0cmp9_257">build.gradle.kts</code> (au niveau du module), puis synchronisez votre projet.</p><div class="code-block" data-lang="kotlin">
dependencies {
    // ... autres dépendances

    // Retrofit pour les appels réseau
    implementation(&quot;com.squareup.retrofit2:retrofit:2.9.0&quot;)
    // Moshi pour la conversion JSON &lt;-&gt; Kotlin
    implementation(&quot;com.squareup.retrofit2:converter-moshi:2.9.0&quot;)
    implementation(&quot;com.squareup.moshi:moshi-kotlin:1.15.0&quot;)

    // Coroutines pour la gestion de l'asynchronisme
    implementation(&quot;org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.3&quot;)
    // LifecycleScope pour lier les coroutines au cycle de vie
    implementation(&quot;androidx.lifecycle:lifecycle-runtime-ktx:2.7.0&quot;)
}
</div></section><section class="chapter"><h4 id="1b-permission-internet" data-toc="1b-permission-internet">1b. Permission Internet</h4><p id="x0cmp9_258">N'oubliez pas d'ajouter la permission d'acc&egrave;s &agrave; Internet dans votre fichier <code class="code" id="x0cmp9_262">AndroidManifest.xml</code>.</p><p id="x0cmp9_259"><span class="control" id="x0cmp9_263">Fichier : <code class="code" id="x0cmp9_264">app/src/main/AndroidManifest.xml</code></span></p><div class="code-block" data-lang="markup">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;&gt;

    &lt;!-- ICI : La permission nécessaire pour faire des appels réseau --&gt;
    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;

    &lt;application
        ...&gt;
        &lt;!-- ... --&gt;
    &lt;/application&gt;

&lt;/manifest&gt;
</div></section></section><section class="chapter"><h3 id="tape-2-cr-ation-de-la-data-class" data-toc="tape-2-cr-ation-de-la-data-class">&Eacute;tape 2 : Cr&eacute;ation de la <code class="code" id="x0cmp9_269">data class</code></h3><p id="x0cmp9_266">Cr&eacute;ez un nouveau fichier Kotlin nomm&eacute; <code class="code" id="x0cmp9_270">DogFactResponse.kt</code>.</p><div class="code-block" data-lang="kotlin">
package com.example.yourapplication // Adaptez votre package

import com.squareup.moshi.Json

// La data class doit correspondre à la structure du JSON.
// Le nom de la propriété 'facts' correspond à la clé &quot;facts&quot; dans le JSON.
data class DogFactResponse(
    val facts: List&lt;String&gt;
    // On pourrait aussi ajouter 'val success: Boolean' mais ce n'est pas nécessaire pour ce TP.
)
</div></section><section class="chapter"><h3 id="tape-3-cr-ation-de-l-interface-apiservice-et-de-l-instance-retrofit" data-toc="tape-3-cr-ation-de-l-interface-apiservice-et-de-l-instance-retrofit">&Eacute;tape 3 : Cr&eacute;ation de l'interface <code class="code" id="x0cmp9_274">ApiService</code> et de l'instance Retrofit</h3><section class="chapter"><h4 id="3a-interface-apiservice-kt" data-toc="3a-interface-apiservice-kt">3a. Interface <code class="code" id="x0cmp9_278">ApiService.kt</code></h4><p id="x0cmp9_276">Cr&eacute;ez un nouveau fichier Kotlin <code class="code" id="x0cmp9_279">ApiService.kt</code>.</p><div class="code-block" data-lang="kotlin">
package com.example.yourapplication

import retrofit2.http.GET

interface ApiService {
    // L'annotation @GET contient le chemin relatif de l'endpoint
    // par rapport à l'URL de base.
    @GET(&quot;api/v1/facts?number=1&quot;)
    // La fonction est marquée 'suspend' pour être appelée depuis une coroutine.
    // Le type de retour est notre data class. Retrofit &amp; Moshi s'occuperont de la conversion.
    suspend fun getDogFact(): DogFactResponse
}
</div></section><section class="chapter"><h4 id="3b-singleton-pour-l-instance-retrofit-retrofitinstance-kt" data-toc="3b-singleton-pour-l-instance-retrofit-retrofitinstance-kt">3b. Singleton pour l'instance Retrofit (<code class="code" id="x0cmp9_284">RetrofitInstance.kt</code>)</h4><p id="x0cmp9_281">C'est une bonne pratique de cr&eacute;er un singleton pour ne pas avoir &agrave; r&eacute;instancier Retrofit &agrave; chaque fois. Cr&eacute;ez un nouveau fichier <code class="code" id="x0cmp9_285">RetrofitInstance.kt</code>.</p><div class="code-block" data-lang="kotlin">
package com.example.yourapplication

import com.squareup.moshi.Moshi
import com.squareup.moshi.kotlin.reflect.KotlinJsonAdapterFactory
import retrofit2.Retrofit
import retrofit2.converter.moshi.MoshiConverterFactory

object RetrofitInstance {

    private const val BASE_URL = &quot;https://dog-api.kinduff.com/&quot;

    // Configuration de Moshi pour qu'il fonctionne bien avec Kotlin
    private val moshi = Moshi.Builder()
        .add(KotlinJsonAdapterFactory())
        .build()

    // Création de l'instance Retrofit (lazy pour n'être initialisée qu'à la première utilisation)
    private val retrofit by lazy {
        Retrofit.Builder()
            .baseUrl(BASE_URL)
            .addConverterFactory(MoshiConverterFactory.create(moshi))
            .build()
    }

    // Création de l'instance du service API
    val api: ApiService by lazy {
        retrofit.create(ApiService::class.java)
    }
}
</div></section></section><section class="chapter"><h3 id="tape-4-le-layout" data-toc="tape-4-le-layout">&Eacute;tape 4 : Le Layout</h3><p id="x0cmp9_286"><span class="control" id="x0cmp9_289">Fichier : <code class="code" id="x0cmp9_290">activity_main.xml</code></span></p><div class="code-block" data-lang="markup">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;androidx.constraintlayout.widget.ConstraintLayout
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:padding=&quot;16dp&quot;
    tools:context=&quot;.MainActivity&quot;&gt;

    &lt;TextView
        android:id=&quot;@+id/factTextView&quot;
        android:layout_width=&quot;0dp&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:gravity=&quot;center&quot;
        android:textSize=&quot;20sp&quot;
        app:layout_constraintBottom_toTopOf=&quot;@+id/newFactButton&quot;
        app:layout_constraintEnd_toEndOf=&quot;parent&quot;
        app:layout_constraintStart_toStartOf=&quot;parent&quot;
        app:layout_constraintTop_toTopOf=&quot;parent&quot;
        app:layout_constraintVertical_bias=&quot;0.4&quot;
        tools:text=&quot;Ici sera affichée une information amusante sur les chiens.&quot; /&gt;

    &lt;!-- Un ProgressBar pour montrer que le chargement est en cours --&gt;
    &lt;ProgressBar
        android:id=&quot;@+id/progressBar&quot;
        style=&quot;?android:attr/progressBarStyle&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:visibility=&quot;gone&quot;
        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;
        app:layout_constraintEnd_toEndOf=&quot;parent&quot;
        app:layout_constraintStart_toStartOf=&quot;parent&quot;
        app:layout_constraintTop_toTopOf=&quot;parent&quot;
        tools:visibility=&quot;visible&quot;/&gt;

    &lt;Button
        android:id=&quot;@+id/newFactButton&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:text=&quot;Nouveau Fait&quot;
        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;
        app:layout_constraintEnd_toEndOf=&quot;parent&quot;
        app:layout_constraintStart_toStartOf=&quot;parent&quot;
        app:layout_constraintTop_toBottomOf=&quot;@+id/factTextView&quot; /&gt;

&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;
</div></section><section class="chapter"><h3 id="tape-5-mainactivity-kt" data-toc="tape-5-mainactivity-kt">&Eacute;tape 5 : <code class="code" id="x0cmp9_296">MainActivity.kt</code></h3><p id="x0cmp9_292">C'est ici que l'on connecte la logique &agrave; l'interface utilisateur.</p><div class="code-block" data-lang="kotlin">
package com.example.yourapplication

import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import android.view.View
import androidx.lifecycle.lifecycleScope
import com.example.yourapplication.databinding.ActivityMainBinding
import kotlinx.coroutines.launch

class MainActivity : AppCompatActivity() {

    private lateinit var binding: ActivityMainBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)

        // Charger une information au démarrage de l'application
        fetchNewFact()

        // Attacher un listener au bouton pour charger une nouvelle information
        binding.newFactButton.setOnClickListener {
            fetchNewFact()
        }
    }

    private fun fetchNewFact() {
        // Lancement d'une coroutine liée au cycle de vie de l'activité
        lifecycleScope.launch {
            // Mettre à jour l'UI pour indiquer le chargement
            binding.progressBar.visibility = View.VISIBLE
            binding.newFactButton.isEnabled = false
            binding.factTextView.text = &quot;&quot;

            try {
                // Appel réseau via notre instance Retrofit
                val response = RetrofitInstance.api.getDogFact()

                // Vérifier si la réponse est valide et si la liste n'est pas vide
                if (response.facts.isNotEmpty()) {
                    // Mettre à jour le TextView avec la première information reçue
                    binding.factTextView.text = response.facts.first()
                } else {
                    binding.factTextView.text = &quot;Aucune information trouvée.&quot;
                }

            } catch (e: Exception) {
                // En cas d'erreur (pas de réseau, etc.), afficher un message d'erreur
                binding.factTextView.text = &quot;Erreur de chargement : ${e.message}&quot;
            } finally {
                // Quoi qu'il arrive (succès ou erreur), on nettoie l'UI
                binding.progressBar.visibility = View.GONE
                binding.newFactButton.isEnabled = true
            }
        }
    }
}
</div><p id="x0cmp9_294"><span class="control" id="x0cmp9_297">Points cl&eacute;s de <code class="code" id="x0cmp9_298">MainActivity</code>:</span></p><ul class="list _bullet" id="x0cmp9_295"><li class="list__item" id="x0cmp9_299"><p id="x0cmp9_303"><span class="control" id="x0cmp9_304"><code class="code" id="x0cmp9_305">lifecycleScope.launch</code></span>: Lance la coroutine. Elle sera automatiquement annul&eacute;e si l'activit&eacute; est d&eacute;truite, &eacute;vitant les fuites de m&eacute;moire.</p></li><li class="list__item" id="x0cmp9_300"><p id="x0cmp9_306"><span class="control" id="x0cmp9_307">Gestion de l'UI</span>: On montre un <code class="code" id="x0cmp9_308">ProgressBar</code> et on d&eacute;sactive le bouton pendant l'appel r&eacute;seau pour donner un retour visuel &agrave; l'utilisateur et &eacute;viter les clics multiples.</p></li><li class="list__item" id="x0cmp9_301"><p id="x0cmp9_309"><span class="control" id="x0cmp9_310"><code class="code" id="x0cmp9_311">try-catch</code></span>: Indispensable pour les appels r&eacute;seau. Une connexion peut &eacute;chouer pour de multiples raisons. Ce bloc permet de g&eacute;rer l'erreur proprement sans faire planter l'application.</p></li><li class="list__item" id="x0cmp9_302"><p id="x0cmp9_312"><span class="control" id="x0cmp9_313"><code class="code" id="x0cmp9_315">finally</code></span>: Ce bloc est ex&eacute;cut&eacute; que l'appel ait r&eacute;ussi ou &eacute;chou&eacute;. C'est l'endroit parfait pour cacher le <code class="code" id="x0cmp9_314">ProgressBar</code> et r&eacute;activer le bouton.</p></li></ul></section></div></div></section><section class="chapter"><h2 id="auto-valuation" data-toc="auto-valuation">Auto-&eacute;valuation</h2><p id="x0cmp9_316"><span class="control" id="x0cmp9_325">1. Quelle m&eacute;thode HTTP est g&eacute;n&eacute;ralement utilis&eacute;e pour r&eacute;cup&eacute;rer des donn&eacute;es depuis une API REST ? (QCM)</span></p><ul class="list _bullet" id="x0cmp9_317"><li class="list__item" id="x0cmp9_326"><p id="x0cmp9_330">A) <code class="code" id="x0cmp9_331">POST</code></p></li><li class="list__item" id="x0cmp9_327"><p id="x0cmp9_332">B) <code class="code" id="x0cmp9_333">GET</code></p></li><li class="list__item" id="x0cmp9_328"><p id="x0cmp9_334">C) <code class="code" id="x0cmp9_335">DELETE</code></p></li><li class="list__item" id="x0cmp9_329"><p id="x0cmp9_336">D) <code class="code" id="x0cmp9_337">UPDATE</code></p></li></ul><p id="x0cmp9_318"><span class="control" id="x0cmp9_338">2. Quel est le r&ocirc;le principal d'un &quot;Converter&quot; (comme <code class="code" id="x0cmp9_339">MoshiConverterFactory</code>) dans Retrofit ? (QCM)</span></p><ul class="list _bullet" id="x0cmp9_319"><li class="list__item" id="x0cmp9_340"><p id="x0cmp9_344">A) G&eacute;rer l'authentification des requ&ecirc;tes.</p></li><li class="list__item" id="x0cmp9_341"><p id="x0cmp9_345">B) Traduire la r&eacute;ponse JSON du serveur en objets <code class="code" id="x0cmp9_346">data class</code> Kotlin.</p></li><li class="list__item" id="x0cmp9_342"><p id="x0cmp9_347">C) Choisir le thread sur lequel l'appel r&eacute;seau sera ex&eacute;cut&eacute;.</p></li><li class="list__item" id="x0cmp9_343"><p id="x0cmp9_348">D) Ajouter des en-t&ecirc;tes (headers) &agrave; la requ&ecirc;te.</p></li></ul><p id="x0cmp9_320"><span class="control" id="x0cmp9_349">3. Dans l'annotation <code class="code" id="x0cmp9_350">@GET(&quot;posts/{id}&quot;)</code>, que repr&eacute;sente <code class="code" id="x0cmp9_351">{id}</code>? (QCM)</span></p><ul class="list _bullet" id="x0cmp9_321"><li class="list__item" id="x0cmp9_352"><p id="x0cmp9_356">A) Un param&egrave;tre de requ&ecirc;te (query parameter) qui sera ajout&eacute; apr&egrave;s un <code class="code" id="x0cmp9_357">?</code>.</p></li><li class="list__item" id="x0cmp9_353"><p id="x0cmp9_358">B) Une partie statique de l'URL.</p></li><li class="list__item" id="x0cmp9_354"><p id="x0cmp9_359">C) Un placeholder pour une variable qui sera inject&eacute;e dans le chemin de l'URL.</p></li><li class="list__item" id="x0cmp9_355"><p id="x0cmp9_360">D) Le corps (body) de la requ&ecirc;te.</p></li></ul><p id="x0cmp9_322"><span class="control" id="x0cmp9_361">4. Pourquoi est-il indispensable d'utiliser des coroutines (ou une autre forme d'asynchronisme) pour les appels r&eacute;seau avec Retrofit ? (Question ouverte)</span></p><p id="x0cmp9_323"><span class="control" id="x0cmp9_362">5. Quel est l'int&eacute;r&ecirc;t de cr&eacute;er un objet Singleton (comme notre <code class="code" id="x0cmp9_363">RetrofitClient</code>) pour g&eacute;rer l'instance de Retrofit ? ( Question ouverte)</span></p><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="correction-de-l-auto-valuation" data-toc="correction-de-l-auto-valuation">Correction de l'auto-&eacute;valuation</h3></div><div class="collapse__content"><p id="x0cmp9_364"><span class="control" id="x0cmp9_375">1. Quelle m&eacute;thode HTTP est utilis&eacute;e pour r&eacute;cup&eacute;rer des donn&eacute;es ?</span></p><ul class="list _bullet" id="x0cmp9_365"><li class="list__item" id="x0cmp9_376"><p id="x0cmp9_378"><span class="control" id="x0cmp9_379">R&eacute;ponse : B) <code class="code" id="x0cmp9_380">GET</code></span></p></li><li class="list__item" id="x0cmp9_377"><p id="x0cmp9_381"><span class="control" id="x0cmp9_382">Justification :</span> Le verbe <code class="code" id="x0cmp9_383">GET</code> est la convention standard de l'architecture REST pour demander une repr&eacute;sentation d'une ressource sans la modifier.</p></li></ul><p id="x0cmp9_366"><span class="control" id="x0cmp9_384">2. Quel est le r&ocirc;le principal d'un &quot;Converter&quot; ?</span></p><ul class="list _bullet" id="x0cmp9_367"><li class="list__item" id="x0cmp9_385"><p id="x0cmp9_387"><span class="control" id="x0cmp9_388">R&eacute;ponse : B) Traduire la r&eacute;ponse JSON du serveur en objets <code class="code" id="x0cmp9_389">data class</code> Kotlin.</span></p></li><li class="list__item" id="x0cmp9_386"><p id="x0cmp9_390"><span class="control" id="x0cmp9_391">Justification :</span> Le convertisseur est le pont entre le monde textuel du JSON et le monde typ&eacute; des objets Kotlin. Il automatise la d&eacute;s&eacute;rialisation.</p></li></ul><p id="x0cmp9_368"><span class="control" id="x0cmp9_392">3. Que repr&eacute;sente <code class="code" id="x0cmp9_393">{id}</code> dans <code class="code" id="x0cmp9_394">@GET(&quot;posts/{id}&quot;)</code>?</span></p><ul class="list _bullet" id="x0cmp9_369"><li class="list__item" id="x0cmp9_395"><p id="x0cmp9_397"><span class="control" id="x0cmp9_398">R&eacute;ponse : C) Un placeholder pour une variable qui sera inject&eacute;e dans le chemin de l'URL.</span></p></li><li class="list__item" id="x0cmp9_396"><p id="x0cmp9_399"><span class="control" id="x0cmp9_400">Justification :</span> C'est ce qu'on appelle un param&egrave;tre de chemin (path parameter). Il est remplac&eacute; par la valeur d'un argument de la m&eacute;thode annot&eacute; avec <code class="code" id="x0cmp9_401">@Path(&quot;id&quot;)</code>.</p></li></ul><p id="x0cmp9_370"><span class="control" id="x0cmp9_402">4. Pourquoi les coroutines sont-elles indispensables pour les appels r&eacute;seau ?</span></p><ul class="list _bullet" id="x0cmp9_371"><li class="list__item" id="x0cmp9_403"><p id="x0cmp9_404"><span class="control" id="x0cmp9_405">R&eacute;ponse type :</span> Les appels r&eacute;seau sont des op&eacute;rations potentiellement tr&egrave;s longues et impr&eacute;visibles (d&eacute;pendent de la connexion, du serveur, etc.). Si on les effectuait sur le thread principal, l'application g&egrave;lerait compl&egrave;tement en attendant la r&eacute;ponse, conduisant &agrave; une mauvaise exp&eacute;rience utilisateur et &agrave; une erreur ANR. Les coroutines permettent d'ex&eacute;cuter ces appels en arri&egrave;re-plan de mani&egrave;re asynchrone, suspendant l'ex&eacute;cution sans bloquer le thread principal, qui reste libre pour g&eacute;rer l'interface utilisateur.</p></li></ul><p id="x0cmp9_372"><span class="control" id="x0cmp9_406">5. Quel est l'int&eacute;r&ecirc;t d'un Singleton pour Retrofit ?</span></p><ul class="list _bullet" id="x0cmp9_373"><li class="list__item" id="x0cmp9_407"><p id="x0cmp9_408"><span class="control" id="x0cmp9_409">R&eacute;ponse type :</span> La cr&eacute;ation d'une instance de Retrofit (et du client HTTP OkHttp qu'il utilise en interne) est une op&eacute;ration &quot;co&ucirc;teuse&quot;. Elle configure des pools de threads, des strat&eacute;gies de cache, des connexions, etc. En utilisant un Singleton, on s'assure que cet objet complexe n'est cr&eacute;&eacute; qu'une seule fois pour toute la dur&eacute;e de vie de l' application. On r&eacute;utilise ensuite cette m&ecirc;me instance pour tous les appels r&eacute;seau, ce qui est beaucoup plus efficace en termes de performance et de consommation de ressources.</p></li></ul></div></div></section></section><section class="chapter"><h2 id="conclusion-du-module" data-toc="conclusion-du-module">Conclusion du module</h2><p id="x0cmp9_410">Vous avez ouvert votre application au monde ! Vous savez maintenant comment d&eacute;finir et consommer une API REST, comment mod&eacute;liser des donn&eacute;es JSON avec des <code class="code" id="x0cmp9_413">data class</code>, et comment utiliser le duo de choc <code class="code" id="x0cmp9_414">Retrofit</code> + <code class="code" id="x0cmp9_415">Coroutines</code> pour effectuer des appels r&eacute;seau de mani&egrave;re propre, s&ucirc;re et asynchrone.</p><p id="x0cmp9_411">C'est une comp&eacute;tence cruciale qui vous permet de cr&eacute;er des applications dynamiques dont le contenu peut &ecirc;tre mis &agrave; jour sans avoir &agrave; red&eacute;ployer l'application.</p><p id="x0cmp9_412">Nous avons maintenant toutes les briques techniques : l'UI, la navigation, la persistance locale et l'acc&egrave;s r&eacute;seau. Mais comment assembler tout &ccedil;a de mani&egrave;re professionnelle, maintenable et testable ? C'est le but de notre derni&egrave;re partie sur l'Architecture, o&ugrave; nous allons d&eacute;couvrir le pattern MVVM recommand&eacute; par Google.</p></section><div class="last-modified">01 novembre 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="004-03-module-12.html" class="navigation-links__prev">Module 12 : Introduction aux Op&eacute;rations Asynchrones (Coroutines Kotlin)</a><a href="005-partie-05.html" class="navigation-links__next">Partie 5 : Architecture et Finalisation</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>