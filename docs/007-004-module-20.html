<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-11-07T11:34:39.720166"><title>Module 20 : Gestion Fiable des T&acirc;ches en Arri&egrave;re-plan avec WorkManager | Android</title><script type="application/json" id="virtual-toc-data">[{"id":"objectifs-p-dagogiques","level":0,"title":"Objectifs pédagogiques","anchor":"#objectifs-p-dagogiques"},{"id":"introduction","level":0,"title":"Introduction","anchor":"#introduction"},{"id":"notions-abord-es","level":0,"title":"Notions abordées","anchor":"#notions-abord-es"},{"id":"les-limites-des-t-ches-en-avant-plan","level":0,"title":"Les Limites des Tâches en Avant-plan","anchor":"#les-limites-des-t-ches-en-avant-plan"},{"id":"les-3-piliers-de-workmanager","level":0,"title":"Les 3 Piliers de WorkManager","anchor":"#les-3-piliers-de-workmanager"},{"id":"planifier-une-t-che-simple","level":0,"title":"Planifier une Tâche Simple","anchor":"#planifier-une-t-che-simple"},{"id":"contraintes-et-t-ches-p-riodiques-th-orie","level":0,"title":"Contraintes et Tâches Périodiques (Théorie)","anchor":"#contraintes-et-t-ches-p-riodiques-th-orie"},{"id":"tp-20-planifier-une-synchronisation-intelligente","level":0,"title":"TP 20 : Planifier une synchronisation \"intelligente\"","anchor":"#tp-20-planifier-une-synchronisation-intelligente"},{"id":"correction-du-tp-20","level":0,"title":"Correction du TP 20","anchor":"#correction-du-tp-20"},{"id":"conclusion-du-module","level":0,"title":"Conclusion du module","anchor":"#conclusion-du-module"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Module 20 : Gestion Fiable des T&acirc;ches en Arri&egrave;re-plan avec WorkManager | Android"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Android Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/007-004-module-20.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Module 20 : Gestion Fiable des T&acirc;ches en Arri&egrave;re-plan avec WorkManager | Android"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/007-004-module-20.html#webpage",
    "url": "writerside-documentation/007-004-module-20.html",
    "name": "Module 20 : Gestion Fiable des T&acirc;ches en Arri&egrave;re-plan avec WorkManager | Android",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Android Help"
}</script><!-- End Schema.org --></head><body data-id="007-004-module-20" data-main-title="Module 20 : Gestion Fiable des Tâches en Arrière-plan avec WorkManager" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="007-bonus.md|Pour aller plus loin : L'Horizon du Développeur Android"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Android  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="007-004-module-20" id="007-004-module-20.md">Module 20 : Gestion Fiable des Tâches en Arrière-plan avec WorkManager</h1><section class="chapter"><h2 id="objectifs-p-dagogiques" data-toc="objectifs-p-dagogiques">Objectifs p&eacute;dagogiques</h2><p id="-uqb6me_13">&Agrave; la fin de ce module, vous serez capable de :</p><ul class="list _bullet" id="-uqb6me_14"><li class="list__item" id="-uqb6me_15"><p id="-uqb6me_20">Expliquer pourquoi les Coroutines simples ou les Threads ne sont pas suffisants pour des t&acirc;ches en arri&egrave;re-plan garanties.</p></li><li class="list__item" id="-uqb6me_16"><p id="-uqb6me_21">D&eacute;finir le r&ocirc;le et les avantages de <code class="code" id="-uqb6me_22">WorkManager</code>.</p></li><li class="list__item" id="-uqb6me_17"><p id="-uqb6me_23">Cr&eacute;er une classe <code class="code" id="-uqb6me_24">Worker</code> pour encapsuler la logique d'une t&acirc;che.</p></li><li class="list__item" id="-uqb6me_18"><p id="-uqb6me_25">Construire et planifier une <code class="code" id="-uqb6me_26">WorkRequest</code> simple (<code class="code" id="-uqb6me_27">OneTimeWorkRequest</code>).</p></li><li class="list__item" id="-uqb6me_19"><p id="-uqb6me_28">(Th&eacute;orie) Comprendre les contraintes (<code class="code" id="-uqb6me_29">Constraints</code>) et les requ&ecirc;tes p&eacute;riodiques (<code class="code" id="-uqb6me_30">PeriodicWorkRequest</code>).</p></li></ul></section><section class="chapter"><h2 id="introduction" data-toc="introduction">Introduction</h2><p id="-uqb6me_31">Imaginez que votre application doit envoyer un rapport de logs au serveur, ou synchroniser des photos, tous les soirs &agrave; minuit. Que se passe-t-il si, &agrave; ce moment-l&agrave;, l'application est ferm&eacute;e ? Si le t&eacute;l&eacute;phone de l'utilisateur n'a pas de connexion internet ? Ou s'il red&eacute;marre juste avant ?</p><p id="-uqb6me_32">Une simple coroutine lanc&eacute;e dans un <code class="code" id="-uqb6me_34">viewModelScope</code> ne survivrait pas &agrave; la fermeture de l'application. Un thread classique non plus. Ces t&acirc;ches seraient simplement perdues. Vous avez besoin d'un &quot;coursier&quot; ultra-fiable et intelligent. Vous lui donnez une mission (le &quot;travail&quot;) et des instructions pr&eacute;cises (&quot;Ne pars que s'il y a du Wi-Fi&quot;, &quot; R&eacute;essaye si tu &eacute;choues&quot;, &quot;Fais-le m&ecirc;me si je ne suis pas l&agrave; pour te surveiller&quot;).</p><p id="-uqb6me_33"><span class="control" id="-uqb6me_35"><code class="code" id="-uqb6me_37">WorkManager</code></span> est ce coursier. C'est la solution recommand&eacute;e par Google pour toute t&acirc;che qui doit &ecirc;tre ex&eacute;cut&eacute;e de mani&egrave;re <span class="control" id="-uqb6me_36">garantie</span>, que l'application soit ouverte ou non. Il g&egrave;re intelligemment les contraintes de l'appareil ( batterie, r&eacute;seau) et la survie aux red&eacute;marrages pour s'assurer que le travail sera fait, quoi qu'il arrive.</p></section><section class="chapter"><h2 id="notions-abord-es" data-toc="notions-abord-es">Notions abord&eacute;es</h2><ul class="list _bullet" id="-uqb6me_38"><li class="list__item" id="-uqb6me_40"><p id="-uqb6me_44">Les Limites des T&acirc;ches en Avant-plan</p></li><li class="list__item" id="-uqb6me_41"><p id="-uqb6me_45">Les 3 Piliers de WorkManager : <code class="code" id="-uqb6me_46">Worker</code>, <code class="code" id="-uqb6me_47">WorkRequest</code>, <code class="code" id="-uqb6me_48">WorkManager</code> (le service)</p></li><li class="list__item" id="-uqb6me_42"><p id="-uqb6me_49">Planifier une T&acirc;che Simple</p></li><li class="list__item" id="-uqb6me_43"><p id="-uqb6me_50">Contraintes et T&acirc;ches P&eacute;riodiques</p></li></ul></section><section class="chapter"><h2 id="les-limites-des-t-ches-en-avant-plan" data-toc="les-limites-des-t-ches-en-avant-plan">Les Limites des T&acirc;ches en Avant-plan</h2><section class="chapter"><h3 id="introduction-la-notion" data-toc="introduction-la-notion">Introduction &agrave; la notion</h3><p id="-uqb6me_53">Une coroutine dans un <code class="code" id="-uqb6me_54">lifecycleScope</code> est comme un employ&eacute; qui ne travaille que lorsque vous &ecirc;tes dans la pi&egrave;ce. D&egrave;s que vous quittez la pi&egrave;ce (le <code class="code" id="-uqb6me_55">Fragment</code> est d&eacute;truit), il arr&ecirc;te de travailler. C'est parfait pour les t&acirc;ches li&eacute;es &agrave; l' UI, mais totalement inadapt&eacute; pour un travail qui doit se terminer de mani&egrave;re ind&eacute;pendante.</p></section><section class="chapter"><h3 id="explication-de-la-notion" data-toc="explication-de-la-notion">Explication de la notion</h3><p id="-uqb6me_56">Depuis les versions r&eacute;centes d'Android, le syst&egrave;me est devenu tr&egrave;s agressif pour limiter l'utilisation des ressources ( batterie, CPU) par les applications en arri&egrave;re-plan. Lancer un service de fond qui tourne ind&eacute;finiment n'est plus une option viable.</p><p id="-uqb6me_57"><span class="control" id="-uqb6me_63">WorkManager</span> a &eacute;t&eacute; con&ccedil;u pour r&eacute;pondre &agrave; ce probl&egrave;me. Ce n'est pas un simple lanceur de threads. C'est un * <span class="emphasis" id="-uqb6me_64">planificateur de t&acirc;ches intelligent</span>* qui n&eacute;gocie avec le syst&egrave;me d'exploitation Android. Il garantit que votre t&acirc;che s'ex&eacute;cutera, mais il choisit le meilleur moment pour le faire afin d'optimiser les ressources de l'appareil.</p><p id="-uqb6me_58"><span class="control" id="-uqb6me_65">WorkManager est id&eacute;al pour les t&acirc;ches :</span></p><ul class="list _bullet" id="-uqb6me_59"><li class="list__item" id="-uqb6me_66"><p id="-uqb6me_68"><span class="control" id="-uqb6me_69">Diff&eacute;rables :</span> Des t&acirc;ches qui n'ont pas besoin d'&ecirc;tre ex&eacute;cut&eacute;es <span class="emphasis" id="-uqb6me_70">imm&eacute;diatement</span>.</p></li><li class="list__item" id="-uqb6me_67"><p id="-uqb6me_71"><span class="control" id="-uqb6me_72">Garanties :</span> Des t&acirc;ches qui doivent s'ex&eacute;cuter <span class="emphasis" id="-uqb6me_73">m&ecirc;me si l'utilisateur quitte l'application ou red&eacute;marre son t&eacute;l&eacute;phone</span>.</p></li></ul><p id="-uqb6me_60"><span class="control" id="-uqb6me_74">Exemples :</span></p><ul class="list _bullet" id="-uqb6me_61"><li class="list__item" id="-uqb6me_75"><p id="-uqb6me_79">Uploader des photos sur un serveur.</p></li><li class="list__item" id="-uqb6me_76"><p id="-uqb6me_80">Appliquer un filtre sur une vid&eacute;o.</p></li><li class="list__item" id="-uqb6me_77"><p id="-uqb6me_81">Synchroniser p&eacute;riodiquement les donn&eacute;es de l'application avec un serveur.</p></li><li class="list__item" id="-uqb6me_78"><p id="-uqb6me_82">Nettoyer le cache de la base de donn&eacute;es une fois par jour.</p></li></ul></section></section><section class="chapter"><h2 id="les-3-piliers-de-workmanager" data-toc="les-3-piliers-de-workmanager">Les 3 Piliers de WorkManager</h2><section class="chapter"><h3 id="introduction-la-notion_1" data-toc="introduction-la-notion_1">Introduction &agrave; la notion</h3><p id="-uqb6me_85">Pour utiliser notre service de coursier, nous avons besoin de trois &eacute;l&eacute;ments :</p><ol class="list _decimal" id="-uqb6me_86" type="1"><li class="list__item" id="-uqb6me_87"><p id="-uqb6me_90"><span class="control" id="-uqb6me_91">Le Colis et les Instructions (<code class="code" id="-uqb6me_92">Worker</code>) :</span> C'est la description de la mission elle-m&ecirc;me. &quot;Prends ce colis (les donn&eacute;es), et voici comment le livrer (la logique &agrave; ex&eacute;cuter)&quot;.</p></li><li class="list__item" id="-uqb6me_88"><p id="-uqb6me_93"><span class="control" id="-uqb6me_94">Le Bon de Commande (<code class="code" id="-uqb6me_95">WorkRequest</code>) :</span> C'est le formulaire que vous remplissez pour demander une livraison. &quot;Je veux une livraison unique&quot;, &quot;Je veux une livraison tous les lundis&quot;, &quot;Ne livrer que si la batterie est en charge&quot;.</p></li><li class="list__item" id="-uqb6me_89"><p id="-uqb6me_96"><span class="control" id="-uqb6me_97">L'Agence de Livraison (<code class="code" id="-uqb6me_98">WorkManager</code>) :</span> C'est le service central &agrave; qui vous remettez votre bon de commande. C'est lui qui g&egrave;re toute la logistique.</p></li></ol></section><section class="chapter"><h3 id="explication-de-la-notion_1" data-toc="explication-de-la-notion_1">Explication de la notion</h3><p id="-uqb6me_99"><span class="control" id="-uqb6me_108">1. <code class="code" id="-uqb6me_111">Worker</code>: La T&acirc;che &agrave; Effectuer</span> C'est une classe qui h&eacute;rite de <code class="code" id="-uqb6me_109">CoroutineWorker</code> (la version moderne pour utiliser les coroutines). Vous y placez la logique de votre t&acirc;che dans la m&eacute;thode <code class="code" id="-uqb6me_110">doWork()</code>.</p><ul class="list _bullet" id="-uqb6me_100"><li class="list__item" id="-uqb6me_112"><p id="-uqb6me_114"><code class="code" id="-uqb6me_115">doWork()</code> est une fonction <code class="code" id="-uqb6me_116">suspend</code>, vous pouvez donc y appeler d'autres fonctions <code class="code" id="-uqb6me_117">suspend</code> (comme des requ&ecirc;tes Room ou Retrofit).</p></li><li class="list__item" id="-uqb6me_113"><p id="-uqb6me_118">Elle doit retourner un <code class="code" id="-uqb6me_120">Result</code>:</p><ul class="list _bullet" id="-uqb6me_119"><li class="list__item" id="-uqb6me_121"><p id="-uqb6me_124"><code class="code" id="-uqb6me_125">Result.success()</code>: La t&acirc;che a r&eacute;ussi.</p></li><li class="list__item" id="-uqb6me_122"><p id="-uqb6me_126"><code class="code" id="-uqb6me_127">Result.failure()</code>: La t&acirc;che a &eacute;chou&eacute;.</p></li><li class="list__item" id="-uqb6me_123"><p id="-uqb6me_128"><code class="code" id="-uqb6me_129">Result.retry()</code>: La t&acirc;che a &eacute;chou&eacute; mais WorkManager doit r&eacute;essayer plus tard.</p></li></ul></li></ul><div class="code-block" data-lang="kotlin">
package fr.formation.workmanager

import android.content.Context
import android.util.Log
import androidx.work.CoroutineWorker
import androidx.work.WorkerParameters
import kotlinx.coroutines.delay

class MySimpleWorker(
    appContext: Context,
    workerParams: WorkerParameters
) : CoroutineWorker(appContext, workerParams) {

    override suspend fun doWork(): Result {
        Log.d(&quot;MySimpleWorker&quot;, &quot;Le travail en arrière-plan commence...&quot;)

        try {
            // Simule une tâche longue, comme un upload
            delay(5000) // Travail pendant 5 secondes

            Log.d(&quot;MySimpleWorker&quot;, &quot;Le travail est terminé avec succès !&quot;)
            return Result.success()
        } catch (e: Exception) {
            Log.e(&quot;MySimpleWorker&quot;, &quot;Le travail a échoué&quot;, e)
            return Result.failure()
        }
    }
}
</div><p id="-uqb6me_102"><span class="control" id="-uqb6me_130">2. <code class="code" id="-uqb6me_132">WorkRequest</code>: La D&eacute;finition de la Planification</span> C'est un objet qui d&eacute;finit comment et quand le <code class="code" id="-uqb6me_131">Worker</code> doit &ecirc;tre ex&eacute;cut&eacute;.</p><ul class="list _bullet" id="-uqb6me_103"><li class="list__item" id="-uqb6me_133"><p id="-uqb6me_135"><span class="control" id="-uqb6me_136"><code class="code" id="-uqb6me_137">OneTimeWorkRequest</code>:</span> Pour une t&acirc;che qui ne doit s'ex&eacute;cuter qu'une seule fois.</p></li><li class="list__item" id="-uqb6me_134"><p id="-uqb6me_138"><span class="control" id="-uqb6me_139"><code class="code" id="-uqb6me_140">PeriodicWorkRequest</code>:</span> Pour une t&acirc;che qui doit se r&eacute;p&eacute;ter (ex: toutes les 24 heures).</p></li></ul><p id="-uqb6me_104"><span class="control" id="-uqb6me_141">3. <code class="code" id="-uqb6me_144">WorkManager</code>: Le Service de Planification</span> C'est le singleton qui vous permet de mettre en file d'attente (<code class="code" id="-uqb6me_142">enqueue</code>) votre <code class="code" id="-uqb6me_143">WorkRequest</code>.</p><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="529px" preserveAspectRatio="none" style="width:1065px;height:529px;background:#FFFFFF;" version="1.1" viewBox="0 0 1065 529" width="1065px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="377" x="346" y="28.5352">Flux de Planification d'une T&#226;che avec WorkManager</text><rect fill="#FFFFFF" height="69.2764" style="stroke:#181818;stroke-width:1.0;" width="10" x="201.5" y="150.2871"/><rect fill="#FFFFFF" height="130.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="512.5" y="300.4844"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="824" y="359.1055"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="118.9766" y2="238.2188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="23" x2="23" y1="238.2188" y2="279.1738"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="279.1738" y2="448.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="206.5" x2="206.5" y1="118.9766" y2="238.2188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="206.5" x2="206.5" y1="238.2188" y2="279.1738"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="206.5" x2="206.5" y1="279.1738" y2="448.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="517" x2="517" y1="118.9766" y2="238.2188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="517" x2="517" y1="238.2188" y2="279.1738"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="517" x2="517" y1="279.1738" y2="448.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="726.5" x2="726.5" y1="118.9766" y2="238.2188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="726.5" x2="726.5" y1="238.2188" y2="279.1738"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="726.5" x2="726.5" y1="279.1738" y2="448.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="828.5" x2="828.5" y1="118.9766" y2="238.2188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="828.5" x2="828.5" y1="238.2188" y2="279.1738"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="828.5" x2="828.5" y1="279.1738" y2="448.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="116.0234">User</text><ellipse cx="23.5" cy="50.9883" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,58.9883 L23.5,85.9883 M10.5,66.9883 L36.5,66.9883 M23.5,85.9883 L10.5,100.9883 M23.5,85.9883 L36.5,100.9883 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="461.2617">User</text><ellipse cx="23.5" cy="472.7148" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,480.7148 L23.5,507.7148 M10.5,488.7148 L36.5,488.7148 M23.5,507.7148 L10.5,522.7148 M23.5,507.7148 L36.5,522.7148 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80" x="166.5" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="173.5" y="108.0234">Fragment</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80" x="166.5" y="447.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="173.5" y="468.2617">Fragment</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="463" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="470" y="108.0234">WorkManager</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="463" y="447.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="470" y="468.2617">WorkManager</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="122" x="665.5" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="672.5" y="108.0234">Android System</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="122" x="665.5" y="447.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="672.5" y="468.2617">Android System</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="63" x="797.5" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="804.5" y="108.0234">Worker</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="63" x="797.5" y="447.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="804.5" y="468.2617">Worker</text><rect fill="#FFFFFF" height="69.2764" style="stroke:#181818;stroke-width:1.0;" width="10" x="201.5" y="150.2871"/><rect fill="#FFFFFF" height="130.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="512.5" y="300.4844"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="824" y="359.1055"/><polygon fill="#181818" points="189.5,146.2871,199.5,150.2871,189.5,154.2871,193.5,150.2871" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="23.5" x2="195.5" y1="150.2871" y2="150.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="30.5" y="145.5449">Clique sur "Synchroniser"</text><polygon fill="#181818" points="505.5,175.5977,515.5,179.5977,505.5,183.5977,509.5,179.5977" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.5" x2="511.5" y1="179.5977" y2="179.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="218.5" y="174.8555">Cr&#233;e une WorkRequest pour MySimpleWorker</text><polygon fill="#181818" points="505.5,215.5635,515.5,219.5635,505.5,223.5635,509.5,219.5635" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="206.5" x2="511.5" y1="219.5635" y2="219.5635"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="213.5" y="214.8213">.enqueue(request)</text><path d="M522,192.5977 L522,232.5977 L755,232.5977 L755,202.5977 L745,192.5977 L522,192.5977 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M745,192.5977 L745,202.5977 L755,202.5977 L745,192.5977 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="528" y="210.166">La t&#226;che est maintenant planifi&#233;e.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="528" y="225.4766">Fragment peut continuer sa vie.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="234" x="309.25" y="262.8535">plus tard (le syst&#232;me &#233;value les contraintes)</text><polygon fill="#181818" points="533.5,296.4844,523.5,300.4844,533.5,304.4844,529.5,300.4844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="527.5" x2="725.5" y1="300.4844" y2="300.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="539.5" y="295.7422">D&#233;clenche la t&#226;che en attente</text><polygon fill="#181818" points="817,325.7949,827,329.7949,817,333.7949,821,329.7949" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="522.5" x2="823" y1="329.7949" y2="329.7949"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="529.5" y="325.0527">Cr&#233;e une instance de MySimpleWorker</text><polygon fill="#181818" points="812,355.1055,822,359.1055,812,363.1055,816,359.1055" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="522.5" x2="818" y1="359.1055" y2="359.1055"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="529.5" y="354.3633">Appelle doWork() sur un thread de fond</text><line style="stroke:#181818;stroke-width:1.0;" x1="834" x2="876" y1="388.416" y2="388.416"/><line style="stroke:#181818;stroke-width:1.0;" x1="876" x2="876" y1="388.416" y2="401.416"/><line style="stroke:#181818;stroke-width:1.0;" x1="835" x2="876" y1="401.416" y2="401.416"/><polygon fill="#181818" points="845,397.416,835,401.416,845,405.416,841,401.416" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="841" y="383.6738">Ex&#233;cute la logique (upload, BDD...)</text><polygon fill="#181818" points="528.5,426.7266,518.5,430.7266,528.5,434.7266,524.5,430.7266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="522.5" x2="828" y1="430.7266" y2="430.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="534.5" y="425.9844">Retourne Result.success()</text><!--SRC=[TPB1Rjim38RlVWeYbzh0vWVeOK2NjC20jXdi3hli8aXi8aocN8aAcjVPQNaElzWefqcSTBq9XFwF_7-IBJk4EvTUmI1yTuhiizMAhISmLuaGdeO_UesWDgZXfm-_7nIf5OQYK9fzW1zHthqARBNj5J7S1RNgaFYiE1LEwxCRCi5R0-qsCdOpK16MxJjfRfSRmUSlHpvSmzpPbuGGKu1PkoMz3fwiV9lbsUn6CPwcAOuwOKp6oPWmx12orrnlK9YHeVU2VTYsjkiTlWtnCQD64bd2CkpbLK5UsWUxMlCrt2lWVOoPt2bBZ9JDzVl0fN_zYuxq7XE3ziIMaj2ZWet5kZ3u7rjrNGibHM0L39Iop2XH3dyxX66tKKxoSHX7MXZxnWf4KnHNC5yspUtywTloKGpSJuI7fUHX1MY6dNOeyM8AnR9zRtvn_03kv9H0iTXaF6tZx7wcZ3VanJeiHLQaCP_cnIO-4j_qFReyiy-biXgF8n7mEg0o6VJioPnFT1Zc0dNxAhOIZvwSNusdLgRUUMK-mTV5GbAiBdIdI1fakH_nq61CZkkOjCOOosgwnKFpYz8XeNy0]--></g></svg></div><figure id="-uqb6me_106"><img alt="workmanager.svg" src="images/workmanager.svg" title="workmanager.svg" width="2138" height="1058"></figure></section></section><section class="chapter"><h2 id="planifier-une-t-che-simple" data-toc="planifier-une-t-che-simple">Planifier une T&acirc;che Simple</h2><section class="chapter"><h3 id="introduction-la-notion_2" data-toc="introduction-la-notion_2">Introduction &agrave; la notion</h3><p id="-uqb6me_148">Nous allons remplir notre premier &quot;bon de commande&quot; et le donner &agrave; l'agence de livraison. C'est une action simple qui va d&eacute;clencher tout le m&eacute;canisme en coulisses.</p></section><section class="chapter"><h3 id="explication-de-la-notion_2" data-toc="explication-de-la-notion_2">Explication de la notion</h3><p id="-uqb6me_149"><span class="control" id="-uqb6me_154">&Eacute;tape 1 : Ajouter la d&eacute;pendance</span> dans <code class="code" id="-uqb6me_155">build.gradle.kts</code></p><div class="code-block" data-lang="kotlin">
dependencies {
    // WorkManager avec le support des coroutines Kotlin
    implementation(&quot;androidx.work:work-runtime-ktx:2.9.0&quot;)
}
</div><p id="-uqb6me_151"><span class="control" id="-uqb6me_156">&Eacute;tape 2 : Cr&eacute;er le <code class="code" id="-uqb6me_157">Worker</code></span> (voir l'exemple ci-dessus)</p><p id="-uqb6me_152"><span class="control" id="-uqb6me_158">&Eacute;tape 3 : Cr&eacute;er et mettre en file d'attente la <code class="code" id="-uqb6me_159">WorkRequest</code> depuis l'UI</span></p><div class="code-block" data-lang="kotlin">
// Dans une Activity ou un Fragment
private fun startBackgroundTask() {
    // 1. On crée le &quot;bon de commande&quot; pour notre Worker
    val myWorkRequest = OneTimeWorkRequestBuilder&lt;MySimpleWorker&gt;().build()

    // 2. On le soumet à l'agence de livraison
    WorkManager.getInstance(requireContext()).enqueue(myWorkRequest)

    Toast.makeText(context, &quot;Tâche de fond planifiée !&quot;, Toast.LENGTH_SHORT).show()
}
</div></section><section class="chapter"><h3 id="exercice-1-lancer-un-nettoyage-de-cache" data-toc="exercice-1-lancer-un-nettoyage-de-cache">Exercice 1 : Lancer un nettoyage de cache</h3><p id="-uqb6me_160"><span class="control" id="-uqb6me_168">&Eacute;nonc&eacute; :</span> Cr&eacute;ez une application avec un bouton &quot;Nettoyer le cache&quot;. Au clic, planifiez un <code class="code" id="-uqb6me_169">Worker</code> qui simule un nettoyage (en affichant un log) apr&egrave;s un d&eacute;lai de 3 secondes.</p><p id="-uqb6me_161"><span class="control" id="-uqb6me_170">Correction exercice 1</span></p><p id="-uqb6me_162"><span class="control" id="-uqb6me_171">1. <code class="code" id="-uqb6me_172">CacheCleanupWorker.kt</code></span></p><div class="code-block" data-lang="kotlin">
package fr.formation.workmanager.workers

import android.content.Context
import android.util.Log
import androidx.work.CoroutineWorker
import androidx.work.WorkerParameters
import kotlinx.coroutines.delay

class CacheCleanupWorker(
    appContext: Context,
    params: WorkerParameters
) : CoroutineWorker(appContext, params) {

    companion object {
        const val TAG = &quot;CacheCleanupWorker&quot;
    }

    override suspend fun doWork(): Result {
        Log.d(TAG, &quot;Début du nettoyage du cache...&quot;)

        return try {
            // Simule une opération qui prend du temps
            delay(3000)
            Log.d(TAG, &quot;Nettoyage du cache terminé avec succès.&quot;)
            Result.success()
        } catch (e: Exception) {
            Log.e(TAG, &quot;Erreur lors du nettoyage du cache.&quot;, e)
            Result.failure()
        }
    }
}
</div><p id="-uqb6me_164"><span class="control" id="-uqb6me_173">2. <code class="code" id="-uqb6me_174">MainActivity.kt</code></span></p><div class="code-block" data-lang="kotlin">
package fr.formation.workmanager

import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import androidx.work.OneTimeWorkRequestBuilder
import androidx.work.WorkManager
import fr.formation.workmanager.databinding.ActivityMainBinding
import fr.formation.workmanager.workers.CacheCleanupWorker

class MainActivity : AppCompatActivity() {

    private lateinit var binding: ActivityMainBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)

        binding.cleanupButton.setOnClickListener {
            startCleanupWork()
        }
    }

    private fun startCleanupWork() {
        // Créer la requête pour une exécution unique
        val cleanupRequest = OneTimeWorkRequestBuilder&lt;CacheCleanupWorker&gt;().build()

        // Soumettre la requête à WorkManager
        WorkManager.getInstance(this).enqueue(cleanupRequest)
    }
}
</div><p id="-uqb6me_166"><span class="control" id="-uqb6me_175">Test :</span> Cliquez sur le bouton, puis fermez imm&eacute;diatement l'application. Ouvrez Logcat et filtrez par &quot; CacheCleanupWorker&quot;. Vous verrez les logs appara&icirc;tre quelques secondes plus tard, prouvant que le travail a &eacute;t&eacute; effectu&eacute; m&ecirc;me si l'application n'&eacute;tait plus au premier plan.</p></section></section><section class="chapter"><h2 id="contraintes-et-t-ches-p-riodiques-th-orie" data-toc="contraintes-et-t-ches-p-riodiques-th-orie">Contraintes et T&acirc;ches P&eacute;riodiques (Th&eacute;orie)</h2><ul class="list _bullet" id="-uqb6me_176"><li class="list__item" id="-uqb6me_178"><p id="-uqb6me_180"><span class="control" id="-uqb6me_182">Contraintes (<code class="code" id="-uqb6me_184">Constraints</code>) :</span> Vous pouvez sp&eacute;cifier des conditions pour l'ex&eacute;cution de votre <code class="code" id="-uqb6me_183">Worker</code>. La t&acirc;che ne d&eacute;marrera que lorsque toutes les contraintes seront satisfaites.</p><div class="code-block" data-lang="kotlin">
val constraints = Constraints.Builder()
    .setRequiredNetworkType(NetworkType.UNMETERED) // Wi-Fi uniquement
    .setRequiresCharging(true) // Uniquement si l'appareil est en charge
    .build()

val myWorkRequest = OneTimeWorkRequestBuilder&lt;MyUploaderWorker&gt;()
    .setConstraints(constraints)
    .build()
</div></li><li class="list__item" id="-uqb6me_179"><p id="-uqb6me_185"><span class="control" id="-uqb6me_188">T&acirc;ches P&eacute;riodiques (<code class="code" id="-uqb6me_189">PeriodicWorkRequest</code>) :</span> Pour les t&acirc;ches qui doivent se r&eacute;p&eacute;ter.</p><aside class="prompt" data-type="warning" data-title="" id="-uqb6me_186"><p>L'intervalle minimum de r&eacute;p&eacute;tition est de 15 minutes. WorkManager n'est pas fait pour des t&acirc;ches en temps r&eacute;el.</p></aside><div class="code-block" data-lang="kotlin">
val syncRequest = PeriodicWorkRequestBuilder&lt;SyncWorker&gt;(
    repeatInterval = 1, // La valeur
    repeatIntervalTimeUnit = TimeUnit.DAYS // L'unité
).build() // Se synchronise environ une fois par jour

WorkManager.getInstance(context).enqueueUniquePeriodicWork(
    &quot;daily-sync&quot;, // Un nom unique pour ne pas la planifier plusieurs fois
    ExistingPeriodicWorkPolicy.KEEP, // Garde l'ancienne si elle existe
    syncRequest
)
</div></li></ul></section><section class="chapter"><h2 id="tp-20-planifier-une-synchronisation-intelligente" data-toc="tp-20-planifier-une-synchronisation-intelligente">TP 20 : Planifier une synchronisation &quot;intelligente&quot;</h2><p id="-uqb6me_190"><span class="control" id="-uqb6me_192">Objectif :</span> Cr&eacute;er un <code class="code" id="-uqb6me_193">Worker</code> qui simule une synchronisation de donn&eacute;es avec un serveur, mais uniquement lorsque l'appareil est connect&eacute; &agrave; un r&eacute;seau Wi-Fi.</p><section class="procedure-steps" id="-uqb6me_191"><ol class="list _decimal" id="-uqb6me_194" type="1"><li class="list__item" id="-uqb6me_195"><p id="-uqb6me_198"><span class="control" id="-uqb6me_199">Cr&eacute;ez un <code class="code" id="-uqb6me_201">SyncWorker</code></span> similaire au <code class="code" id="-uqb6me_200">CacheCleanupWorker</code>. Il doit simplement afficher des logs indiquant le d&eacute;but et la fin de la synchronisation.</p></li><li class="list__item" id="-uqb6me_196"><p id="-uqb6me_202"><span class="control" id="-uqb6me_204">Dans <code class="code" id="-uqb6me_205">MainActivity</code>, au clic sur un bouton :</span></p><ul class="list _bullet" id="-uqb6me_203"><li class="list__item" id="-uqb6me_206"><p id="-uqb6me_210">Cr&eacute;ez un objet <code class="code" id="-uqb6me_211">Constraints</code> qui exige un type de r&eacute;seau <code class="code" id="-uqb6me_212">NetworkType.UNMETERED</code> (ce qui correspond g&eacute;n&eacute;ralement au Wi-Fi).</p></li><li class="list__item" id="-uqb6me_207"><p id="-uqb6me_213">Cr&eacute;ez une <code class="code" id="-uqb6me_214">OneTimeWorkRequest</code> pour votre <code class="code" id="-uqb6me_215">SyncWorker</code>.</p></li><li class="list__item" id="-uqb6me_208"><p id="-uqb6me_216">Appliquez les contraintes &agrave; votre requ&ecirc;te en utilisant la m&eacute;thode <code class="code" id="-uqb6me_217">.setConstraints()</code>.</p></li><li class="list__item" id="-uqb6me_209"><p id="-uqb6me_218">Mettez la requ&ecirc;te en file d'attente.</p></li></ul></li><li class="list__item" id="-uqb6me_197"><p id="-uqb6me_219"><span class="control" id="-uqb6me_221">Testez :</span></p><ul class="list _bullet" id="-uqb6me_220"><li class="list__item" id="-uqb6me_222"><p id="-uqb6me_225"><span class="control" id="-uqb6me_226">Cas 1 :</span> Assurez-vous que votre &eacute;mulateur/t&eacute;l&eacute;phone est en Wi-Fi. Cliquez sur le bouton. La t&acirc;che doit s'ex&eacute;cuter apr&egrave;s quelques secondes.</p></li><li class="list__item" id="-uqb6me_223"><p id="-uqb6me_227"><span class="control" id="-uqb6me_228">Cas 2 :</span> D&eacute;sactivez le Wi-Fi (passez en donn&eacute;es mobiles ou en mode avion). Cliquez sur le bouton. Observez le Logcat : la t&acirc;che <span class="control" id="-uqb6me_229">ne s'ex&eacute;cute pas</span>.</p></li><li class="list__item" id="-uqb6me_224"><p id="-uqb6me_230"><span class="control" id="-uqb6me_231">Cas 3 :</span> R&eacute;activez le Wi-Fi. La t&acirc;che que vous aviez planifi&eacute;e pr&eacute;c&eacute;demment devrait maintenant se lancer automatiquement !</p></li></ul></li></ol><ol class="list _decimal"></ol></section></section><section class="chapter"><h2 id="correction-du-tp-20" data-toc="correction-du-tp-20">Correction du TP 20</h2><section class="chapter"><h3 id="tape-0-configuration-du-projet" data-toc="tape-0-configuration-du-projet">&Eacute;tape 0 : Configuration du Projet</h3><p id="-uqb6me_236">Si ce n'est pas d&eacute;j&agrave; fait, ajoutez la d&eacute;pendance <code class="code" id="-uqb6me_239">WorkManager</code> &agrave; votre fichier <code class="code" id="-uqb6me_240">build.gradle.kts</code> (module) et synchronisez.</p><div class="code-block" data-lang="kotlin">
dependencies {
    // ... autres dépendances

    // WorkManager (version la plus récente recommandée)
    implementation(&quot;androidx.work:work-runtime-ktx:2.9.0&quot;)
}
</div></section><section class="chapter"><h3 id="tape-1-cr-er-le-syncworker" data-toc="tape-1-cr-er-le-syncworker">&Eacute;tape 1 : Cr&eacute;er le <code class="code" id="-uqb6me_247">SyncWorker</code></h3><p id="-uqb6me_242">Cr&eacute;ez un nouveau fichier Kotlin nomm&eacute; <code class="code" id="-uqb6me_248">SyncWorker.kt</code>. Ce worker est tr&egrave;s simple : il simule un travail en affichant des logs.</p><div class="code-block" data-lang="kotlin">
package com.example.yourapplication // Adaptez votre package

import android.content.Context
import android.util.Log
import androidx.work.CoroutineWorker
import androidx.work.WorkerParameters
import kotlinx.coroutines.delay

class SyncWorker(
    appContext: Context,
    workerParams: WorkerParameters
) : CoroutineWorker(appContext, workerParams) {

    // Le tag pour les logs, facile à retrouver dans Logcat
    companion object {
        const val TAG = &quot;SyncWorker&quot;
    }

    /**
     * C'est ici que le travail de fond est effectué.
     * Cette fonction est appelée par WorkManager sur un thread d'arrière-plan.
     */
    override suspend fun doWork(): Result {
        Log.d(TAG, &quot;Début de la synchronisation...&quot;)

        try {
            // Simuler un travail qui prend du temps, comme un appel réseau
            delay(3000) // Attend 3 secondes

            // Ici, vous mettriez votre vraie logique de synchronisation
            Log.d(TAG, &quot;Synchronisation terminée avec succès !&quot;)

            // Indiquer à WorkManager que le travail a réussi
            return Result.success()

        } catch (e: Exception) {
            Log.e(TAG, &quot;Erreur pendant la synchronisation&quot;, e)

            // Indiquer à WorkManager que le travail a échoué et doit être retenté
            // selon la politique de réessai définie (par défaut, exponentielle).
            return Result.retry()
        }
    }
}
</div><p id="-uqb6me_244"><span class="control" id="-uqb6me_249">Points cl&eacute;s :</span></p><ul class="list _bullet" id="-uqb6me_245"><li class="list__item" id="-uqb6me_250"><p id="-uqb6me_253">Il h&eacute;rite de <code class="code" id="-uqb6me_254">CoroutineWorker</code>, ce qui permet d'utiliser des fonctions <code class="code" id="-uqb6me_255">suspend</code> comme <code class="code" id="-uqb6me_256">delay</code>. C'est la pratique moderne recommand&eacute;e.</p></li><li class="list__item" id="-uqb6me_251"><p id="-uqb6me_257"><code class="code" id="-uqb6me_258">doWork()</code> est la m&eacute;thode principale o&ugrave; la logique s'ex&eacute;cute.</p></li><li class="list__item" id="-uqb6me_252"><p id="-uqb6me_259">Le retour de <code class="code" id="-uqb6me_261">doWork()</code> est crucial :</p><ul class="list _bullet" id="-uqb6me_260"><li class="list__item" id="-uqb6me_262"><p id="-uqb6me_265"><code class="code" id="-uqb6me_266">Result.success()</code>: Le travail est termin&eacute;.</p></li><li class="list__item" id="-uqb6me_263"><p id="-uqb6me_267"><code class="code" id="-uqb6me_268">Result.failure()</code>: Le travail a &eacute;chou&eacute; et ne doit pas &ecirc;tre retent&eacute;.</p></li><li class="list__item" id="-uqb6me_264"><p id="-uqb6me_269"><code class="code" id="-uqb6me_270">Result.retry()</code>: Le travail a &eacute;chou&eacute; mais WorkManager devrait essayer de le relancer plus tard.</p></li></ul></li></ul></section><section class="chapter"><h3 id="tape-2-mettre-jour-l-ui-activity-main-xml-et-la-mainactivity-kt" data-toc="tape-2-mettre-jour-l-ui-activity-main-xml-et-la-mainactivity-kt">&Eacute;tape 2 : Mettre &agrave; jour l'UI (<code class="code" id="-uqb6me_274">activity_main.xml</code>) et la <code class="code" id="-uqb6me_275">MainActivity.kt</code></h3><section class="chapter"><h4 id="le-layout" data-toc="le-layout">Le Layout</h4><p id="-uqb6me_276">Un layout simple avec un bouton pour lancer la synchronisation et un TextView pour donner un retour &agrave; l'utilisateur.</p><p id="-uqb6me_277"><span class="control" id="-uqb6me_279">Fichier : <code class="code" id="-uqb6me_280">activity_main.xml</code></span></p><div class="code-block" data-lang="markup">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;http=&quot; schemas.android.com/apk/res/android&quot;
        xmlns:tools=&quot;http=&quot;schemas.android.com/tools&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot;
        android:gravity=&quot;center&quot;
        android:orientation=&quot;vertical&quot;
        android:padding=&quot;16dp&quot;
        tools:context=&quot;.MainActivity&quot;&gt;

&lt;TextView
android:id=&quot;@+id/statusTextView&quot;
android:layout_width=&quot;wrap_content&quot;
android:layout_height=&quot;wrap_content&quot;
android:text=&quot;Prêt à synchroniser.&quot;
android:textSize=&quot;18sp&quot;
android:gravity=&quot;center&quot;
android:layout_marginBottom=&quot;24dp&quot;/&gt;

&lt;Button
android:id=&quot;@+id/syncButton&quot;
android:layout_width=&quot;wrap_content&quot;
android:layout_height=&quot;wrap_content&quot;
android:text=&quot;Lancer la synchronisation (Wi-Fi requis)&quot;/&gt;

        &lt;/LinearLayout&gt;
</div></section><section class="chapter"><h4 id="la-mainactivity-kt" data-toc="la-mainactivity-kt">La <code class="code" id="-uqb6me_287">MainActivity.kt</code></h4><p id="-uqb6me_282">C'est ici que l'on va construire et mettre en file d'attente notre requ&ecirc;te de travail avec ses contraintes.</p><div class="code-block" data-lang="kotlin">
package com.example.yourapplication

import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import androidx.work.Constraints
import androidx.work.NetworkType
import androidx.work.OneTimeWorkRequestBuilder
import androidx.work.WorkManager
import com.example.yourapplication.databinding.ActivityMainBinding

class MainActivity : AppCompatActivity() {

    private lateinit var binding: ActivityMainBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)

        binding.syncButton.setOnClickListener {
            scheduleSyncWorker()
        }
    }

    private fun scheduleSyncWorker() {
        // Étape 2a: Créer un objet Constraints
        val constraints = Constraints.Builder()
            // Exiger une connexion réseau non-mesurée (généralement Wi-Fi ou Ethernet)
            .setRequiredNetworkType(NetworkType.UNMETERED)
            // Vous pouvez ajouter d'autres contraintes ici, par exemple :
            // .setRequiresCharging(true) // Exiger que l'appareil soit en charge
            .build()

        // Étape 2b: Créer une requête de travail unique (OneTimeWorkRequest)
        val syncWorkRequest = OneTimeWorkRequestBuilder&lt;SyncWorker&gt;()
            // Étape 2c: Appliquer les contraintes à la requête
            .setConstraints(constraints)
            .build()

        // Étape 2d: Mettre la requête en file d'attente
        WorkManager.getInstance(this).enqueue(syncWorkRequest)

        // Donner un retour à l'utilisateur
        binding.statusTextView.text =
            &quot;Tâche de synchronisation planifiée.\nElle s'exécutera dès que l'appareil sera connecté au Wi-Fi.&quot;
    }
}
</div><p id="-uqb6me_284"><span class="control" id="-uqb6me_288">Explications :</span></p><ul class="list _bullet" id="-uqb6me_285"><li class="list__item" id="-uqb6me_289"><p id="-uqb6me_294"><span class="control" id="-uqb6me_295"><code class="code" id="-uqb6me_296">Constraints.Builder()</code></span>: C'est l'outil pour d&eacute;finir les conditions d'ex&eacute;cution.</p></li><li class="list__item" id="-uqb6me_290"><p id="-uqb6me_297"><span class="control" id="-uqb6me_298"><code class="code" id="-uqb6me_300">setRequiredNetworkType(NetworkType.UNMETERED)</code></span>: C'est la contrainte cl&eacute; de ce TP. <code class="code" id="-uqb6me_299">UNMETERED</code> signifie une connexion qui n'est pas factur&eacute;e &agrave; l'usage (donc pas les donn&eacute;es mobiles).</p></li><li class="list__item" id="-uqb6me_291"><p id="-uqb6me_301"><span class="control" id="-uqb6me_302"><code class="code" id="-uqb6me_304">OneTimeWorkRequestBuilder&lt;SyncWorker&gt;()</code></span>: On cr&eacute;e une requ&ecirc;te pour ex&eacute;cuter notre <code class="code" id="-uqb6me_303">SyncWorker</code> une seule fois.</p></li><li class="list__item" id="-uqb6me_292"><p id="-uqb6me_305"><span class="control" id="-uqb6me_306"><code class="code" id="-uqb6me_307">.setConstraints(constraints)</code></span>: On attache nos contraintes &agrave; la requ&ecirc;te.</p></li><li class="list__item" id="-uqb6me_293"><p id="-uqb6me_308"><span class="control" id="-uqb6me_309"><code class="code" id="-uqb6me_312">WorkManager.getInstance(this).enqueue(...)</code></span>: On soumet notre requ&ecirc;te &agrave; <code class="code" id="-uqb6me_310">WorkManager</code>. C'est <code class="code" id="-uqb6me_311">WorkManager</code> qui va maintenant surveiller les contraintes et d&eacute;cider du meilleur moment pour ex&eacute;cuter la t&acirc;che.</p></li></ul></section></section><section class="chapter"><h3 id="tape-3-tester" data-toc="tape-3-tester">&Eacute;tape 3 : Tester</h3><p id="-uqb6me_313">Pour tester efficacement, vous aurez besoin de la fen&ecirc;tre <span class="control" id="-uqb6me_317">Logcat</span> dans Android Studio.</p><ol class="list _decimal" id="-uqb6me_314" type="1"><li class="list__item" id="-uqb6me_318"><p id="-uqb6me_322"><span class="control" id="-uqb6me_323">Filtrez Logcat</span> pour ne voir que les messages de notre worker. Dans la barre de recherche de Logcat, tapez <code class="code" id="-uqb6me_324">tag:SyncWorker</code>.</p></li><li class="list__item" id="-uqb6me_319"><p id="-uqb6me_325"><span class="control" id="-uqb6me_327">Cas 1 : Wi-Fi activ&eacute;</span></p><ul class="list _bullet" id="-uqb6me_326"><li class="list__item" id="-uqb6me_328"><p id="-uqb6me_333">Assurez-vous que votre t&eacute;l&eacute;phone ou &eacute;mulateur est connect&eacute; au Wi-Fi.</p></li><li class="list__item" id="-uqb6me_329"><p id="-uqb6me_334">Lancez l'application et cliquez sur le bouton.</p></li><li class="list__item" id="-uqb6me_330"><p id="-uqb6me_335">Le TextView se met &agrave; jour.</p></li><li class="list__item" id="-uqb6me_331"><p id="-uqb6me_336">Dans Logcat, vous devriez voir appara&icirc;tre apr&egrave;s quelques secondes :</p><div class="code-block" data-lang="none">
D/SyncWorker: Début de la synchronisation...
(3 secondes plus tard)
D/SyncWorker: Synchronisation terminée avec succès !
</div></li><li class="list__item" id="-uqb6me_332"><p id="-uqb6me_338"><span class="control" id="-uqb6me_339">Succ&egrave;s !</span> La t&acirc;che s'est ex&eacute;cut&eacute;e car les contraintes &eacute;taient remplies.</p></li></ul></li><li class="list__item" id="-uqb6me_320"><p id="-uqb6me_340"><span class="control" id="-uqb6me_342">Cas 2 : Wi-Fi d&eacute;sactiv&eacute;</span></p><ul class="list _bullet" id="-uqb6me_341"><li class="list__item" id="-uqb6me_343"><p id="-uqb6me_348">D&eacute;sactivez le Wi-Fi sur votre appareil (vous pouvez laisser les donn&eacute;es mobiles activ&eacute;es ou passer en mode avion).</p></li><li class="list__item" id="-uqb6me_344"><p id="-uqb6me_349">Cliquez sur le bouton.</p></li><li class="list__item" id="-uqb6me_345"><p id="-uqb6me_350">Le TextView se met &agrave; jour, indiquant que la t&acirc;che est planifi&eacute;e.</p></li><li class="list__item" id="-uqb6me_346"><p id="-uqb6me_351">Regardez Logcat : <span class="control" id="-uqb6me_352">rien ne se passe</span>. Aucun log de &quot;D&eacute;but de la synchronisation...&quot; n'appara&icirc;t.</p></li><li class="list__item" id="-uqb6me_347"><p id="-uqb6me_353"><span class="control" id="-uqb6me_354">Succ&egrave;s !</span> La t&acirc;che est en attente car la contrainte <code class="code" id="-uqb6me_355">UNMETERED</code> n'est pas remplie.</p></li></ul></li><li class="list__item" id="-uqb6me_321"><p id="-uqb6me_356"><span class="control" id="-uqb6me_358">Cas 3 : R&eacute;activation du Wi-Fi</span></p><ul class="list _bullet" id="-uqb6me_357"><li class="list__item" id="-uqb6me_359"><p id="-uqb6me_363">Sans rien faire d'autre dans l'application, r&eacute;activez le Wi-Fi sur votre appareil.</p></li><li class="list__item" id="-uqb6me_360"><p id="-uqb6me_364">Patientez quelques secondes.</p></li><li class="list__item" id="-uqb6me_361"><p id="-uqb6me_365">Regardez Logcat. Magie ! Les logs du worker apparaissent :</p><div class="code-block" data-lang="none">
D/SyncWorker: Début de la synchronisation...
(3 secondes plus tard)
D/SyncWorker: Synchronisation terminée avec succès !
</div></li><li class="list__item" id="-uqb6me_362"><p id="-uqb6me_367"><span class="control" id="-uqb6me_368">Succ&egrave;s !</span> D&egrave;s que la contrainte a &eacute;t&eacute; satisfaite, <code class="code" id="-uqb6me_369">WorkManager</code> a automatiquement lanc&eacute; la t&acirc;che qui &eacute;tait en attente.</p></li></ul></li></ol><p id="-uqb6me_315">Ce comportement d&eacute;montre la puissance et la fiabilit&eacute; de <code class="code" id="-uqb6me_370">WorkManager</code> pour g&eacute;rer des t&acirc;ches diff&eacute;r&eacute;es et contraintes.</p></section></section><section class="chapter"><h2 id="conclusion-du-module" data-toc="conclusion-du-module">Conclusion du module</h2><p id="-uqb6me_371">Vous avez maintenant ajout&eacute; &agrave; votre arsenal l'outil le plus puissant pour g&eacute;rer les t&acirc;ches en arri&egrave;re-plan de mani&egrave;re fiable. <code class="code" id="-uqb6me_374">WorkManager</code> est la solution moderne pour garantir que les op&eacute;rations importantes de votre application ( synchronisation, uploads, traitement de donn&eacute;es) seront men&eacute;es &agrave; bien, tout en respectant la batterie et les ressources de l'utilisateur.</p><p id="-uqb6me_372">Cette comp&eacute;tence est particuli&egrave;rement importante pour les applications qui ont besoin de maintenir des donn&eacute;es &agrave; jour ou d'effectuer des op&eacute;rations lourdes sans d&eacute;pendre de la pr&eacute;sence de l'utilisateur.</p><p id="-uqb6me_373">Vous avez maintenant une vue d'ensemble compl&egrave;te et approfondie des comp&eacute;tences requises pour &ecirc;tre un d&eacute;veloppeur Android moderne et efficace. F&eacute;licitations pour avoir parcouru tout ce chemin</p></section><div class="last-modified">01 novembre 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="007-03-module-19.html" class="navigation-links__prev">Module 19 : Gestion des Permissions et Donn&eacute;es Sensibles</a><a href="007-005-module-21.html" class="navigation-links__next">Module 21 : Int&eacute;grer les Capacit&eacute;s Natives du T&eacute;l&eacute;phone</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>