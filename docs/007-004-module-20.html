<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-10-30T17:42:53.802807"><title>Module 20 : Gestion Fiable des T&acirc;ches en Arri&egrave;re-plan avec WorkManager | Android</title><script type="application/json" id="virtual-toc-data">[{"id":"objectifs-p-dagogiques","level":0,"title":"Objectifs pédagogiques","anchor":"#objectifs-p-dagogiques"},{"id":"introduction","level":0,"title":"Introduction","anchor":"#introduction"},{"id":"notions-abord-es","level":0,"title":"Notions abordées","anchor":"#notions-abord-es"},{"id":"les-limites-des-t-ches-en-avant-plan","level":0,"title":"Les Limites des Tâches en Avant-plan","anchor":"#les-limites-des-t-ches-en-avant-plan"},{"id":"les-3-piliers-de-workmanager","level":0,"title":"Les 3 Piliers de WorkManager","anchor":"#les-3-piliers-de-workmanager"},{"id":"planifier-une-t-che-simple","level":0,"title":"Planifier une Tâche Simple","anchor":"#planifier-une-t-che-simple"},{"id":"contraintes-et-t-ches-p-riodiques-th-orie","level":0,"title":"Contraintes et Tâches Périodiques (Théorie)","anchor":"#contraintes-et-t-ches-p-riodiques-th-orie"},{"id":"tp-20-planifier-une-synchronisation-intelligente","level":0,"title":"TP 20 : Planifier une synchronisation \"intelligente\"","anchor":"#tp-20-planifier-une-synchronisation-intelligente"},{"id":"conclusion-du-module","level":0,"title":"Conclusion du module","anchor":"#conclusion-du-module"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Module 20 : Gestion Fiable des T&acirc;ches en Arri&egrave;re-plan avec WorkManager | Android"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Android Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/007-004-module-20.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Module 20 : Gestion Fiable des T&acirc;ches en Arri&egrave;re-plan avec WorkManager | Android"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/007-004-module-20.html#webpage",
    "url": "writerside-documentation/007-004-module-20.html",
    "name": "Module 20 : Gestion Fiable des T&acirc;ches en Arri&egrave;re-plan avec WorkManager | Android",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Android Help"
}</script><!-- End Schema.org --></head><body data-id="007-004-module-20" data-main-title="Module 20 : Gestion Fiable des Tâches en Arrière-plan avec WorkManager" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="007-bonus.md|Pour aller plus loin : L'Horizon du Développeur Android"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Android  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="007-004-module-20" id="007-004-module-20.md">Module 20 : Gestion Fiable des Tâches en Arrière-plan avec WorkManager</h1><section class="chapter"><h2 id="objectifs-p-dagogiques" data-toc="objectifs-p-dagogiques">Objectifs p&eacute;dagogiques</h2><p id="-uqb6me_12">&Agrave; la fin de ce module, vous serez capable de :</p><ul class="list _bullet" id="-uqb6me_13"><li class="list__item" id="-uqb6me_14"><p id="-uqb6me_19">Expliquer pourquoi les Coroutines simples ou les Threads ne sont pas suffisants pour des t&acirc;ches en arri&egrave;re-plan garanties.</p></li><li class="list__item" id="-uqb6me_15"><p id="-uqb6me_20">D&eacute;finir le r&ocirc;le et les avantages de <code class="code" id="-uqb6me_21">WorkManager</code>.</p></li><li class="list__item" id="-uqb6me_16"><p id="-uqb6me_22">Cr&eacute;er une classe <code class="code" id="-uqb6me_23">Worker</code> pour encapsuler la logique d'une t&acirc;che.</p></li><li class="list__item" id="-uqb6me_17"><p id="-uqb6me_24">Construire et planifier une <code class="code" id="-uqb6me_25">WorkRequest</code> simple (<code class="code" id="-uqb6me_26">OneTimeWorkRequest</code>).</p></li><li class="list__item" id="-uqb6me_18"><p id="-uqb6me_27">(Th&eacute;orie) Comprendre les contraintes (<code class="code" id="-uqb6me_28">Constraints</code>) et les requ&ecirc;tes p&eacute;riodiques (<code class="code" id="-uqb6me_29">PeriodicWorkRequest</code>).</p></li></ul></section><section class="chapter"><h2 id="introduction" data-toc="introduction">Introduction</h2><p id="-uqb6me_30">Imaginez que votre application doit envoyer un rapport de logs au serveur, ou synchroniser des photos, tous les soirs &agrave; minuit. Que se passe-t-il si, &agrave; ce moment-l&agrave;, l'application est ferm&eacute;e ? Si le t&eacute;l&eacute;phone de l'utilisateur n'a pas de connexion internet ? Ou s'il red&eacute;marre juste avant ?</p><p id="-uqb6me_31">Une simple coroutine lanc&eacute;e dans un <code class="code" id="-uqb6me_33">viewModelScope</code> ne survivrait pas &agrave; la fermeture de l'application. Un thread classique non plus. Ces t&acirc;ches seraient simplement perdues. Vous avez besoin d'un &quot;coursier&quot; ultra-fiable et intelligent. Vous lui donnez une mission (le &quot;travail&quot;) et des instructions pr&eacute;cises (&quot;Ne pars que s'il y a du Wi-Fi&quot;, &quot; R&eacute;essaye si tu &eacute;choues&quot;, &quot;Fais-le m&ecirc;me si je ne suis pas l&agrave; pour te surveiller&quot;).</p><p id="-uqb6me_32"><span class="control" id="-uqb6me_34"><code class="code" id="-uqb6me_36">WorkManager</code></span> est ce coursier. C'est la solution recommand&eacute;e par Google pour toute t&acirc;che qui doit &ecirc;tre ex&eacute;cut&eacute;e de mani&egrave;re <span class="control" id="-uqb6me_35">garantie</span>, que l'application soit ouverte ou non. Il g&egrave;re intelligemment les contraintes de l'appareil ( batterie, r&eacute;seau) et la survie aux red&eacute;marrages pour s'assurer que le travail sera fait, quoi qu'il arrive.</p></section><section class="chapter"><h2 id="notions-abord-es" data-toc="notions-abord-es">Notions abord&eacute;es</h2><ul class="list _bullet" id="-uqb6me_37"><li class="list__item" id="-uqb6me_39"><p id="-uqb6me_43">Les Limites des T&acirc;ches en Avant-plan</p></li><li class="list__item" id="-uqb6me_40"><p id="-uqb6me_44">Les 3 Piliers de WorkManager : <code class="code" id="-uqb6me_45">Worker</code>, <code class="code" id="-uqb6me_46">WorkRequest</code>, <code class="code" id="-uqb6me_47">WorkManager</code> (le service)</p></li><li class="list__item" id="-uqb6me_41"><p id="-uqb6me_48">Planifier une T&acirc;che Simple</p></li><li class="list__item" id="-uqb6me_42"><p id="-uqb6me_49">Contraintes et T&acirc;ches P&eacute;riodiques</p></li></ul></section><section class="chapter"><h2 id="les-limites-des-t-ches-en-avant-plan" data-toc="les-limites-des-t-ches-en-avant-plan">Les Limites des T&acirc;ches en Avant-plan</h2><section class="chapter"><h3 id="introduction-la-notion" data-toc="introduction-la-notion">Introduction &agrave; la notion</h3><p id="-uqb6me_52">Une coroutine dans un <code class="code" id="-uqb6me_53">lifecycleScope</code> est comme un employ&eacute; qui ne travaille que lorsque vous &ecirc;tes dans la pi&egrave;ce. D&egrave;s que vous quittez la pi&egrave;ce (le <code class="code" id="-uqb6me_54">Fragment</code> est d&eacute;truit), il arr&ecirc;te de travailler. C'est parfait pour les t&acirc;ches li&eacute;es &agrave; l' UI, mais totalement inadapt&eacute; pour un travail qui doit se terminer de mani&egrave;re ind&eacute;pendante.</p></section><section class="chapter"><h3 id="explication-de-la-notion" data-toc="explication-de-la-notion">Explication de la notion</h3><p id="-uqb6me_55">Depuis les versions r&eacute;centes d'Android, le syst&egrave;me est devenu tr&egrave;s agressif pour limiter l'utilisation des ressources ( batterie, CPU) par les applications en arri&egrave;re-plan. Lancer un service de fond qui tourne ind&eacute;finiment n'est plus une option viable.</p><p id="-uqb6me_56"><span class="control" id="-uqb6me_62">WorkManager</span> a &eacute;t&eacute; con&ccedil;u pour r&eacute;pondre &agrave; ce probl&egrave;me. Ce n'est pas un simple lanceur de threads. C'est un * <span class="emphasis" id="-uqb6me_63">planificateur de t&acirc;ches intelligent</span>* qui n&eacute;gocie avec le syst&egrave;me d'exploitation Android. Il garantit que votre t&acirc;che s'ex&eacute;cutera, mais il choisit le meilleur moment pour le faire afin d'optimiser les ressources de l'appareil.</p><p id="-uqb6me_57"><span class="control" id="-uqb6me_64">WorkManager est id&eacute;al pour les t&acirc;ches :</span></p><ul class="list _bullet" id="-uqb6me_58"><li class="list__item" id="-uqb6me_65"><p id="-uqb6me_67"><span class="control" id="-uqb6me_68">Diff&eacute;rables :</span> Des t&acirc;ches qui n'ont pas besoin d'&ecirc;tre ex&eacute;cut&eacute;es <span class="emphasis" id="-uqb6me_69">imm&eacute;diatement</span>.</p></li><li class="list__item" id="-uqb6me_66"><p id="-uqb6me_70"><span class="control" id="-uqb6me_71">Garanties :</span> Des t&acirc;ches qui doivent s'ex&eacute;cuter <span class="emphasis" id="-uqb6me_72">m&ecirc;me si l'utilisateur quitte l'application ou red&eacute;marre son t&eacute;l&eacute;phone</span>.</p></li></ul><p id="-uqb6me_59"><span class="control" id="-uqb6me_73">Exemples :</span></p><ul class="list _bullet" id="-uqb6me_60"><li class="list__item" id="-uqb6me_74"><p id="-uqb6me_78">Uploader des photos sur un serveur.</p></li><li class="list__item" id="-uqb6me_75"><p id="-uqb6me_79">Appliquer un filtre sur une vid&eacute;o.</p></li><li class="list__item" id="-uqb6me_76"><p id="-uqb6me_80">Synchroniser p&eacute;riodiquement les donn&eacute;es de l'application avec un serveur.</p></li><li class="list__item" id="-uqb6me_77"><p id="-uqb6me_81">Nettoyer le cache de la base de donn&eacute;es une fois par jour.</p></li></ul></section></section><section class="chapter"><h2 id="les-3-piliers-de-workmanager" data-toc="les-3-piliers-de-workmanager">Les 3 Piliers de WorkManager</h2><section class="chapter"><h3 id="introduction-la-notion_1" data-toc="introduction-la-notion_1">Introduction &agrave; la notion</h3><p id="-uqb6me_84">Pour utiliser notre service de coursier, nous avons besoin de trois &eacute;l&eacute;ments :</p><ol class="list _decimal" id="-uqb6me_85" type="1"><li class="list__item" id="-uqb6me_86"><p id="-uqb6me_89"><span class="control" id="-uqb6me_90">Le Colis et les Instructions (<code class="code" id="-uqb6me_91">Worker</code>) :</span> C'est la description de la mission elle-m&ecirc;me. &quot;Prends ce colis (les donn&eacute;es), et voici comment le livrer (la logique &agrave; ex&eacute;cuter)&quot;.</p></li><li class="list__item" id="-uqb6me_87"><p id="-uqb6me_92"><span class="control" id="-uqb6me_93">Le Bon de Commande (<code class="code" id="-uqb6me_94">WorkRequest</code>) :</span> C'est le formulaire que vous remplissez pour demander une livraison. &quot;Je veux une livraison unique&quot;, &quot;Je veux une livraison tous les lundis&quot;, &quot;Ne livrer que si la batterie est en charge&quot;.</p></li><li class="list__item" id="-uqb6me_88"><p id="-uqb6me_95"><span class="control" id="-uqb6me_96">L'Agence de Livraison (<code class="code" id="-uqb6me_97">WorkManager</code>) :</span> C'est le service central &agrave; qui vous remettez votre bon de commande. C'est lui qui g&egrave;re toute la logistique.</p></li></ol></section><section class="chapter"><h3 id="explication-de-la-notion_1" data-toc="explication-de-la-notion_1">Explication de la notion</h3><p id="-uqb6me_98"><span class="control" id="-uqb6me_107">1. <code class="code" id="-uqb6me_110">Worker</code>: La T&acirc;che &agrave; Effectuer</span> C'est une classe qui h&eacute;rite de <code class="code" id="-uqb6me_108">CoroutineWorker</code> (la version moderne pour utiliser les coroutines). Vous y placez la logique de votre t&acirc;che dans la m&eacute;thode <code class="code" id="-uqb6me_109">doWork()</code>.</p><ul class="list _bullet" id="-uqb6me_99"><li class="list__item" id="-uqb6me_111"><p id="-uqb6me_113"><code class="code" id="-uqb6me_114">doWork()</code> est une fonction <code class="code" id="-uqb6me_115">suspend</code>, vous pouvez donc y appeler d'autres fonctions <code class="code" id="-uqb6me_116">suspend</code> (comme des requ&ecirc;tes Room ou Retrofit).</p></li><li class="list__item" id="-uqb6me_112"><p id="-uqb6me_117">Elle doit retourner un <code class="code" id="-uqb6me_119">Result</code>:</p><ul class="list _bullet" id="-uqb6me_118"><li class="list__item" id="-uqb6me_120"><p id="-uqb6me_123"><code class="code" id="-uqb6me_124">Result.success()</code>: La t&acirc;che a r&eacute;ussi.</p></li><li class="list__item" id="-uqb6me_121"><p id="-uqb6me_125"><code class="code" id="-uqb6me_126">Result.failure()</code>: La t&acirc;che a &eacute;chou&eacute;.</p></li><li class="list__item" id="-uqb6me_122"><p id="-uqb6me_127"><code class="code" id="-uqb6me_128">Result.retry()</code>: La t&acirc;che a &eacute;chou&eacute; mais WorkManager doit r&eacute;essayer plus tard.</p></li></ul></li></ul><div class="code-block" data-lang="kotlin">
package fr.formation.workmanager

import android.content.Context
import android.util.Log
import androidx.work.CoroutineWorker
import androidx.work.WorkerParameters
import kotlinx.coroutines.delay

class MySimpleWorker(
    appContext: Context,
    workerParams: WorkerParameters
) : CoroutineWorker(appContext, workerParams) {

    override suspend fun doWork(): Result {
        Log.d(&quot;MySimpleWorker&quot;, &quot;Le travail en arrière-plan commence...&quot;)

        try {
            // Simule une tâche longue, comme un upload
            delay(5000) // Travail pendant 5 secondes

            Log.d(&quot;MySimpleWorker&quot;, &quot;Le travail est terminé avec succès !&quot;)
            return Result.success()
        } catch (e: Exception) {
            Log.e(&quot;MySimpleWorker&quot;, &quot;Le travail a échoué&quot;, e)
            return Result.failure()
        }
    }
}
</div><p id="-uqb6me_101"><span class="control" id="-uqb6me_129">2. <code class="code" id="-uqb6me_131">WorkRequest</code>: La D&eacute;finition de la Planification</span> C'est un objet qui d&eacute;finit comment et quand le <code class="code" id="-uqb6me_130">Worker</code> doit &ecirc;tre ex&eacute;cut&eacute;.</p><ul class="list _bullet" id="-uqb6me_102"><li class="list__item" id="-uqb6me_132"><p id="-uqb6me_134"><span class="control" id="-uqb6me_135"><code class="code" id="-uqb6me_136">OneTimeWorkRequest</code>:</span> Pour une t&acirc;che qui ne doit s'ex&eacute;cuter qu'une seule fois.</p></li><li class="list__item" id="-uqb6me_133"><p id="-uqb6me_137"><span class="control" id="-uqb6me_138"><code class="code" id="-uqb6me_139">PeriodicWorkRequest</code>:</span> Pour une t&acirc;che qui doit se r&eacute;p&eacute;ter (ex: toutes les 24 heures).</p></li></ul><p id="-uqb6me_103"><span class="control" id="-uqb6me_140">3. <code class="code" id="-uqb6me_143">WorkManager</code>: Le Service de Planification</span> C'est le singleton qui vous permet de mettre en file d'attente (<code class="code" id="-uqb6me_141">enqueue</code>) votre <code class="code" id="-uqb6me_142">WorkRequest</code>.</p><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="529px" preserveAspectRatio="none" style="width:1065px;height:529px;background:#FFFFFF;" version="1.1" viewBox="0 0 1065 529" width="1065px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="377" x="346" y="28.5352">Flux de Planification d'une T&#226;che avec WorkManager</text><rect fill="#FFFFFF" height="69.2764" style="stroke:#181818;stroke-width:1.0;" width="10" x="201.5" y="150.2871"/><rect fill="#FFFFFF" height="130.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="512.5" y="300.4844"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="824" y="359.1055"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="118.9766" y2="238.2188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="23" x2="23" y1="238.2188" y2="279.1738"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="279.1738" y2="448.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="206.5" x2="206.5" y1="118.9766" y2="238.2188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="206.5" x2="206.5" y1="238.2188" y2="279.1738"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="206.5" x2="206.5" y1="279.1738" y2="448.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="517" x2="517" y1="118.9766" y2="238.2188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="517" x2="517" y1="238.2188" y2="279.1738"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="517" x2="517" y1="279.1738" y2="448.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="726.5" x2="726.5" y1="118.9766" y2="238.2188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="726.5" x2="726.5" y1="238.2188" y2="279.1738"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="726.5" x2="726.5" y1="279.1738" y2="448.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="828.5" x2="828.5" y1="118.9766" y2="238.2188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="828.5" x2="828.5" y1="238.2188" y2="279.1738"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="828.5" x2="828.5" y1="279.1738" y2="448.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="116.0234">User</text><ellipse cx="23.5" cy="50.9883" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,58.9883 L23.5,85.9883 M10.5,66.9883 L36.5,66.9883 M23.5,85.9883 L10.5,100.9883 M23.5,85.9883 L36.5,100.9883 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="461.2617">User</text><ellipse cx="23.5" cy="472.7148" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,480.7148 L23.5,507.7148 M10.5,488.7148 L36.5,488.7148 M23.5,507.7148 L10.5,522.7148 M23.5,507.7148 L36.5,522.7148 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80" x="166.5" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="173.5" y="108.0234">Fragment</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80" x="166.5" y="447.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="173.5" y="468.2617">Fragment</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="463" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="470" y="108.0234">WorkManager</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="463" y="447.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="470" y="468.2617">WorkManager</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="122" x="665.5" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="672.5" y="108.0234">Android System</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="122" x="665.5" y="447.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="672.5" y="468.2617">Android System</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="63" x="797.5" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="804.5" y="108.0234">Worker</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="63" x="797.5" y="447.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="804.5" y="468.2617">Worker</text><rect fill="#FFFFFF" height="69.2764" style="stroke:#181818;stroke-width:1.0;" width="10" x="201.5" y="150.2871"/><rect fill="#FFFFFF" height="130.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="512.5" y="300.4844"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="824" y="359.1055"/><polygon fill="#181818" points="189.5,146.2871,199.5,150.2871,189.5,154.2871,193.5,150.2871" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="23.5" x2="195.5" y1="150.2871" y2="150.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="30.5" y="145.5449">Clique sur "Synchroniser"</text><polygon fill="#181818" points="505.5,175.5977,515.5,179.5977,505.5,183.5977,509.5,179.5977" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.5" x2="511.5" y1="179.5977" y2="179.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="218.5" y="174.8555">Cr&#233;e une WorkRequest pour MySimpleWorker</text><polygon fill="#181818" points="505.5,215.5635,515.5,219.5635,505.5,223.5635,509.5,219.5635" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="206.5" x2="511.5" y1="219.5635" y2="219.5635"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="213.5" y="214.8213">.enqueue(request)</text><path d="M522,192.5977 L522,232.5977 L755,232.5977 L755,202.5977 L745,192.5977 L522,192.5977 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M745,192.5977 L745,202.5977 L755,202.5977 L745,192.5977 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="528" y="210.166">La t&#226;che est maintenant planifi&#233;e.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="528" y="225.4766">Fragment peut continuer sa vie.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="234" x="309.25" y="262.8535">plus tard (le syst&#232;me &#233;value les contraintes)</text><polygon fill="#181818" points="533.5,296.4844,523.5,300.4844,533.5,304.4844,529.5,300.4844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="527.5" x2="725.5" y1="300.4844" y2="300.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="539.5" y="295.7422">D&#233;clenche la t&#226;che en attente</text><polygon fill="#181818" points="817,325.7949,827,329.7949,817,333.7949,821,329.7949" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="522.5" x2="823" y1="329.7949" y2="329.7949"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="529.5" y="325.0527">Cr&#233;e une instance de MySimpleWorker</text><polygon fill="#181818" points="812,355.1055,822,359.1055,812,363.1055,816,359.1055" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="522.5" x2="818" y1="359.1055" y2="359.1055"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="529.5" y="354.3633">Appelle doWork() sur un thread de fond</text><line style="stroke:#181818;stroke-width:1.0;" x1="834" x2="876" y1="388.416" y2="388.416"/><line style="stroke:#181818;stroke-width:1.0;" x1="876" x2="876" y1="388.416" y2="401.416"/><line style="stroke:#181818;stroke-width:1.0;" x1="835" x2="876" y1="401.416" y2="401.416"/><polygon fill="#181818" points="845,397.416,835,401.416,845,405.416,841,401.416" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="841" y="383.6738">Ex&#233;cute la logique (upload, BDD...)</text><polygon fill="#181818" points="528.5,426.7266,518.5,430.7266,528.5,434.7266,524.5,430.7266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="522.5" x2="828" y1="430.7266" y2="430.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="534.5" y="425.9844">Retourne Result.success()</text><!--SRC=[TPB1Rjim38RlVWeYbzh0vWVeOK2NjC20jXdi3hli8aXi8aocN8aAcjVPQNaElzWefqcSTBq9XFwF_7-IBJk4EvTUmI1yTuhiizMAhISmLuaGdeO_UesWDgZXfm-_7nIf5OQYK9fzW1zHthqARBNj5J7S1RNgaFYiE1LEwxCRCi5R0-qsCdOpK16MxJjfRfSRmUSlHpvSmzpPbuGGKu1PkoMz3fwiV9lbsUn6CPwcAOuwOKp6oPWmx12orrnlK9YHeVU2VTYsjkiTlWtnCQD64bd2CkpbLK5UsWUxMlCrt2lWVOoPt2bBZ9JDzVl0fN_zYuxq7XE3ziIMaj2ZWet5kZ3u7rjrNGibHM0L39Iop2XH3dyxX66tKKxoSHX7MXZxnWf4KnHNC5yspUtywTloKGpSJuI7fUHX1MY6dNOeyM8AnR9zRtvn_03kv9H0iTXaF6tZx7wcZ3VanJeiHLQaCP_cnIO-4j_qFReyiy-biXgF8n7mEg0o6VJioPnFT1Zc0dNxAhOIZvwSNusdLgRUUMK-mTV5GbAiBdIdI1fakH_nq61CZkkOjCOOosgwnKFpYz8XeNy0]--></g></svg></div><figure id="-uqb6me_105"><img alt="workmanager.svg" src="images/workmanager.svg" title="workmanager.svg" width="2138" height="1058"></figure></section></section><section class="chapter"><h2 id="planifier-une-t-che-simple" data-toc="planifier-une-t-che-simple">Planifier une T&acirc;che Simple</h2><section class="chapter"><h3 id="introduction-la-notion_2" data-toc="introduction-la-notion_2">Introduction &agrave; la notion</h3><p id="-uqb6me_147">Nous allons remplir notre premier &quot;bon de commande&quot; et le donner &agrave; l'agence de livraison. C'est une action simple qui va d&eacute;clencher tout le m&eacute;canisme en coulisses.</p></section><section class="chapter"><h3 id="explication-de-la-notion_2" data-toc="explication-de-la-notion_2">Explication de la notion</h3><p id="-uqb6me_148"><span class="control" id="-uqb6me_153">&Eacute;tape 1 : Ajouter la d&eacute;pendance</span> dans <code class="code" id="-uqb6me_154">build.gradle.kts</code></p><div class="code-block" data-lang="kotlin">
dependencies {
    // WorkManager avec le support des coroutines Kotlin
    implementation(&quot;androidx.work:work-runtime-ktx:2.9.0&quot;)
}
</div><p id="-uqb6me_150"><span class="control" id="-uqb6me_155">&Eacute;tape 2 : Cr&eacute;er le <code class="code" id="-uqb6me_156">Worker</code></span> (voir l'exemple ci-dessus)</p><p id="-uqb6me_151"><span class="control" id="-uqb6me_157">&Eacute;tape 3 : Cr&eacute;er et mettre en file d'attente la <code class="code" id="-uqb6me_158">WorkRequest</code> depuis l'UI</span></p><div class="code-block" data-lang="kotlin">
// Dans une Activity ou un Fragment
private fun startBackgroundTask() {
    // 1. On crée le &quot;bon de commande&quot; pour notre Worker
    val myWorkRequest = OneTimeWorkRequestBuilder&lt;MySimpleWorker&gt;().build()

    // 2. On le soumet à l'agence de livraison
    WorkManager.getInstance(requireContext()).enqueue(myWorkRequest)

    Toast.makeText(context, &quot;Tâche de fond planifiée !&quot;, Toast.LENGTH_SHORT).show()
}
</div></section><section class="chapter"><h3 id="exercice-1-lancer-un-nettoyage-de-cache" data-toc="exercice-1-lancer-un-nettoyage-de-cache">Exercice 1 : Lancer un nettoyage de cache</h3><p id="-uqb6me_159"><span class="control" id="-uqb6me_167">&Eacute;nonc&eacute; :</span> Cr&eacute;ez une application avec un bouton &quot;Nettoyer le cache&quot;. Au clic, planifiez un <code class="code" id="-uqb6me_168">Worker</code> qui simule un nettoyage (en affichant un log) apr&egrave;s un d&eacute;lai de 3 secondes.</p><p id="-uqb6me_160"><span class="control" id="-uqb6me_169">Correction exercice 1</span></p><p id="-uqb6me_161"><span class="control" id="-uqb6me_170">1. <code class="code" id="-uqb6me_171">CacheCleanupWorker.kt</code></span></p><div class="code-block" data-lang="kotlin">
package fr.formation.workmanager.workers

import android.content.Context
import android.util.Log
import androidx.work.CoroutineWorker
import androidx.work.WorkerParameters
import kotlinx.coroutines.delay

class CacheCleanupWorker(
    appContext: Context,
    params: WorkerParameters
) : CoroutineWorker(appContext, params) {

    companion object {
        const val TAG = &quot;CacheCleanupWorker&quot;
    }

    override suspend fun doWork(): Result {
        Log.d(TAG, &quot;Début du nettoyage du cache...&quot;)

        return try {
            // Simule une opération qui prend du temps
            delay(3000)
            Log.d(TAG, &quot;Nettoyage du cache terminé avec succès.&quot;)
            Result.success()
        } catch (e: Exception) {
            Log.e(TAG, &quot;Erreur lors du nettoyage du cache.&quot;, e)
            Result.failure()
        }
    }
}
</div><p id="-uqb6me_163"><span class="control" id="-uqb6me_172">2. <code class="code" id="-uqb6me_173">MainActivity.kt</code></span></p><div class="code-block" data-lang="kotlin">
package fr.formation.workmanager

import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import androidx.work.OneTimeWorkRequestBuilder
import androidx.work.WorkManager
import fr.formation.workmanager.databinding.ActivityMainBinding
import fr.formation.workmanager.workers.CacheCleanupWorker

class MainActivity : AppCompatActivity() {

    private lateinit var binding: ActivityMainBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)

        binding.cleanupButton.setOnClickListener {
            startCleanupWork()
        }
    }

    private fun startCleanupWork() {
        // Créer la requête pour une exécution unique
        val cleanupRequest = OneTimeWorkRequestBuilder&lt;CacheCleanupWorker&gt;().build()

        // Soumettre la requête à WorkManager
        WorkManager.getInstance(this).enqueue(cleanupRequest)
    }
}
</div><p id="-uqb6me_165"><span class="control" id="-uqb6me_174">Test :</span> Cliquez sur le bouton, puis fermez imm&eacute;diatement l'application. Ouvrez Logcat et filtrez par &quot; CacheCleanupWorker&quot;. Vous verrez les logs appara&icirc;tre quelques secondes plus tard, prouvant que le travail a &eacute;t&eacute; effectu&eacute; m&ecirc;me si l'application n'&eacute;tait plus au premier plan.</p></section></section><section class="chapter"><h2 id="contraintes-et-t-ches-p-riodiques-th-orie" data-toc="contraintes-et-t-ches-p-riodiques-th-orie">Contraintes et T&acirc;ches P&eacute;riodiques (Th&eacute;orie)</h2><ul class="list _bullet" id="-uqb6me_175"><li class="list__item" id="-uqb6me_177"><p id="-uqb6me_179"><span class="control" id="-uqb6me_181">Contraintes (<code class="code" id="-uqb6me_183">Constraints</code>) :</span> Vous pouvez sp&eacute;cifier des conditions pour l'ex&eacute;cution de votre <code class="code" id="-uqb6me_182">Worker</code>. La t&acirc;che ne d&eacute;marrera que lorsque toutes les contraintes seront satisfaites.</p><div class="code-block" data-lang="kotlin">
val constraints = Constraints.Builder()
    .setRequiredNetworkType(NetworkType.UNMETERED) // Wi-Fi uniquement
    .setRequiresCharging(true) // Uniquement si l'appareil est en charge
    .build()

val myWorkRequest = OneTimeWorkRequestBuilder&lt;MyUploaderWorker&gt;()
    .setConstraints(constraints)
    .build()
</div></li><li class="list__item" id="-uqb6me_178"><p id="-uqb6me_184"><span class="control" id="-uqb6me_187">T&acirc;ches P&eacute;riodiques (<code class="code" id="-uqb6me_188">PeriodicWorkRequest</code>) :</span> Pour les t&acirc;ches qui doivent se r&eacute;p&eacute;ter.</p><aside class="prompt" data-type="warning" data-title="" id="-uqb6me_185"><p>L'intervalle minimum de r&eacute;p&eacute;tition est de 15 minutes. WorkManager n'est pas fait pour des t&acirc;ches en temps r&eacute;el.</p></aside><div class="code-block" data-lang="kotlin">
val syncRequest = PeriodicWorkRequestBuilder&lt;SyncWorker&gt;(
    repeatInterval = 1, // La valeur
    repeatIntervalTimeUnit = TimeUnit.DAYS // L'unité
).build() // Se synchronise environ une fois par jour

WorkManager.getInstance(context).enqueueUniquePeriodicWork(
    &quot;daily-sync&quot;, // Un nom unique pour ne pas la planifier plusieurs fois
    ExistingPeriodicWorkPolicy.KEEP, // Garde l'ancienne si elle existe
    syncRequest
)
</div></li></ul></section><section class="chapter"><h2 id="tp-20-planifier-une-synchronisation-intelligente" data-toc="tp-20-planifier-une-synchronisation-intelligente">TP 20 : Planifier une synchronisation &quot;intelligente&quot;</h2><p id="-uqb6me_189"><span class="control" id="-uqb6me_192">Objectif :</span> Cr&eacute;er un <code class="code" id="-uqb6me_193">Worker</code> qui simule une synchronisation de donn&eacute;es avec un serveur, mais uniquement lorsque l'appareil est connect&eacute; &agrave; un r&eacute;seau Wi-Fi.</p><section class="procedure-steps" id="-uqb6me_190"><ol class="list _decimal" id="-uqb6me_194" type="1"><li class="list__item" id="-uqb6me_195"><p id="-uqb6me_198"><span class="control" id="-uqb6me_199">Cr&eacute;ez un <code class="code" id="-uqb6me_201">SyncWorker</code></span> similaire au <code class="code" id="-uqb6me_200">CacheCleanupWorker</code>. Il doit simplement afficher des logs indiquant le d&eacute;but et la fin de la synchronisation.</p></li><li class="list__item" id="-uqb6me_196"><p id="-uqb6me_202"><span class="control" id="-uqb6me_204">Dans <code class="code" id="-uqb6me_205">MainActivity</code>, au clic sur un bouton :</span></p><ul class="list _bullet" id="-uqb6me_203"><li class="list__item" id="-uqb6me_206"><p id="-uqb6me_210">Cr&eacute;ez un objet <code class="code" id="-uqb6me_211">Constraints</code> qui exige un type de r&eacute;seau <code class="code" id="-uqb6me_212">NetworkType.UNMETERED</code> (ce qui correspond g&eacute;n&eacute;ralement au Wi-Fi).</p></li><li class="list__item" id="-uqb6me_207"><p id="-uqb6me_213">Cr&eacute;ez une <code class="code" id="-uqb6me_214">OneTimeWorkRequest</code> pour votre <code class="code" id="-uqb6me_215">SyncWorker</code>.</p></li><li class="list__item" id="-uqb6me_208"><p id="-uqb6me_216">Appliquez les contraintes &agrave; votre requ&ecirc;te en utilisant la m&eacute;thode <code class="code" id="-uqb6me_217">.setConstraints()</code>.</p></li><li class="list__item" id="-uqb6me_209"><p id="-uqb6me_218">Mettez la requ&ecirc;te en file d'attente.</p></li></ul></li><li class="list__item" id="-uqb6me_197"><p id="-uqb6me_219"><span class="control" id="-uqb6me_221">Testez :</span></p><ul class="list _bullet" id="-uqb6me_220"><li class="list__item" id="-uqb6me_222"><p id="-uqb6me_225"><span class="control" id="-uqb6me_226">Cas 1 :</span> Assurez-vous que votre &eacute;mulateur/t&eacute;l&eacute;phone est en Wi-Fi. Cliquez sur le bouton. La t&acirc;che doit s'ex&eacute;cuter apr&egrave;s quelques secondes.</p></li><li class="list__item" id="-uqb6me_223"><p id="-uqb6me_227"><span class="control" id="-uqb6me_228">Cas 2 :</span> D&eacute;sactivez le Wi-Fi (passez en donn&eacute;es mobiles ou en mode avion). Cliquez sur le bouton. Observez le Logcat : la t&acirc;che <span class="control" id="-uqb6me_229">ne s'ex&eacute;cute pas</span>.</p></li><li class="list__item" id="-uqb6me_224"><p id="-uqb6me_230"><span class="control" id="-uqb6me_231">Cas 3 :</span> R&eacute;activez le Wi-Fi. La t&acirc;che que vous aviez planifi&eacute;e pr&eacute;c&eacute;demment devrait maintenant se lancer automatiquement !</p></li></ul></li></ol><ol class="list _decimal"></ol></section></section><section class="chapter"><h2 id="conclusion-du-module" data-toc="conclusion-du-module">Conclusion du module</h2><p id="-uqb6me_232">Vous avez maintenant ajout&eacute; &agrave; votre arsenal l'outil le plus puissant pour g&eacute;rer les t&acirc;ches en arri&egrave;re-plan de mani&egrave;re fiable. <code class="code" id="-uqb6me_235">WorkManager</code> est la solution moderne pour garantir que les op&eacute;rations importantes de votre application ( synchronisation, uploads, traitement de donn&eacute;es) seront men&eacute;es &agrave; bien, tout en respectant la batterie et les ressources de l'utilisateur.</p><p id="-uqb6me_233">Cette comp&eacute;tence est particuli&egrave;rement importante pour les applications qui ont besoin de maintenir des donn&eacute;es &agrave; jour ou d'effectuer des op&eacute;rations lourdes sans d&eacute;pendre de la pr&eacute;sence de l'utilisateur.</p><p id="-uqb6me_234">Vous avez maintenant une vue d'ensemble compl&egrave;te et approfondie des comp&eacute;tences requises pour &ecirc;tre un d&eacute;veloppeur Android moderne et efficace. F&eacute;licitations pour avoir parcouru tout ce chemin</p></section><div class="last-modified">30 octobre 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="007-03-module-19.html" class="navigation-links__prev">Module 19 : Gestion des Permissions et Donn&eacute;es Sensibles</a><a href="007-005-module-21.html" class="navigation-links__next">Module 21 : Int&eacute;grer les Capacit&eacute;s Natives du T&eacute;l&eacute;phone</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>